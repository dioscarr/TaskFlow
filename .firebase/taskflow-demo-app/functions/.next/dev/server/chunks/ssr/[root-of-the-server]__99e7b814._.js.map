{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACtB"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAqBsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,8CAAA"}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAOsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,oDAAA"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/components/ConfirmationModal.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { AlertTriangle, X } from 'lucide-react';\r\n\r\ninterface ConfirmationModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onConfirm: () => void;\r\n    title?: string;\r\n    message?: string;\r\n    confirmText?: string;\r\n    cancelText?: string;\r\n    isDanger?: boolean;\r\n    isLoading?: boolean;\r\n}\r\n\r\nexport default function ConfirmationModal({\r\n    isOpen,\r\n    onClose,\r\n    onConfirm,\r\n    title = 'Are you sure?',\r\n    message = 'This action cannot be undone.',\r\n    confirmText = 'Confirm',\r\n    cancelText = 'Cancel',\r\n    isDanger = false,\r\n    isLoading = false\r\n}: ConfirmationModalProps) {\r\n    return (\r\n        <AnimatePresence>\r\n            {isOpen && (\r\n                <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n                    {/* Backdrop */}\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        onClick={!isLoading ? onClose : undefined}\r\n                        className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\r\n                    />\r\n\r\n                    {/* Modal */}\r\n                    <motion.div\r\n                        initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                        animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                        exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                        className=\"w-full max-w-md bg-zinc-900 border border-white/10 rounded-2xl p-6 shadow-2xl relative z-10\"\r\n                    >\r\n                        {/* Close Button */}\r\n                        <button\r\n                            onClick={onClose}\r\n                            disabled={isLoading}\r\n                            className=\"absolute top-4 right-4 p-2 text-white/40 hover:text-white rounded-full hover:bg-white/10 transition-colors disabled:opacity-50\"\r\n                        >\r\n                            <X size={20} />\r\n                        </button>\r\n\r\n                        <div className=\"flex flex-col items-center text-center\">\r\n                            {/* Icon */}\r\n                            <div className={`w-12 h-12 rounded-full flex items-center justify-center mb-4 ${isDanger ? 'bg-red-500/20 text-red-400' : 'bg-blue-500/20 text-blue-400'\r\n                                }`}>\r\n                                <AlertTriangle size={24} />\r\n                            </div>\r\n\r\n                            <h3 className=\"text-xl font-bold text-white mb-2\">{title}</h3>\r\n                            <p className=\"text-white/60 mb-8 leading-relaxed\">\r\n                                {message}\r\n                            </p>\r\n\r\n                            <div className=\"flex gap-3 w-full\">\r\n                                <button\r\n                                    onClick={onClose}\r\n                                    disabled={isLoading}\r\n                                    className=\"flex-1 px-4 py-2.5 rounded-lg border border-white/10 text-white/70 hover:text-white hover:bg-white/5 font-medium transition-all\"\r\n                                >\r\n                                    {cancelText}\r\n                                </button>\r\n                                <button\r\n                                    onClick={onConfirm}\r\n                                    disabled={isLoading}\r\n                                    className={`flex-1 px-4 py-2.5 rounded-lg font-medium text-white transition-all shadow-lg ${isDanger\r\n                                        ? 'bg-red-600 hover:bg-red-500 hover:shadow-red-500/20'\r\n                                        : 'bg-blue-600 hover:bg-blue-500 hover:shadow-blue-500/20'\r\n                                        } disabled:opacity-50 disabled:cursor-not-allowed`}\r\n                                >\r\n                                    {isLoading ? 'Processing...' : confirmText}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </motion.div>\r\n                </div>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;AAAA;AACA;AAAA;AAJA;;;;AAkBe,SAAS,kBAAkB,EACtC,MAAM,EACN,OAAO,EACP,SAAS,EACT,QAAQ,eAAe,EACvB,UAAU,+BAA+B,EACzC,cAAc,SAAS,EACvB,aAAa,QAAQ,EACrB,WAAW,KAAK,EAChB,YAAY,KAAK,EACI;IACrB,qBACI,8OAAC,4MAAe;kBACX,wBACG,8OAAC;YAAI,WAAU;;8BAEX,8OAAC,oMAAM,CAAC,GAAG;oBACP,SAAS;wBAAE,SAAS;oBAAE;oBACtB,SAAS;wBAAE,SAAS;oBAAE;oBACtB,MAAM;wBAAE,SAAS;oBAAE;oBACnB,SAAS,CAAC,YAAY,UAAU;oBAChC,WAAU;;;;;;8BAId,8OAAC,oMAAM,CAAC,GAAG;oBACP,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBAC1C,SAAS;wBAAE,SAAS;wBAAG,OAAO;wBAAG,GAAG;oBAAE;oBACtC,MAAM;wBAAE,SAAS;wBAAG,OAAO;wBAAM,GAAG;oBAAG;oBACvC,WAAU;;sCAGV,8OAAC;4BACG,SAAS;4BACT,UAAU;4BACV,WAAU;sCAEV,cAAA,8OAAC,iMAAC;gCAAC,MAAM;;;;;;;;;;;sCAGb,8OAAC;4BAAI,WAAU;;8CAEX,8OAAC;oCAAI,WAAW,CAAC,6DAA6D,EAAE,WAAW,+BAA+B,gCACpH;8CACF,cAAA,8OAAC,yOAAa;wCAAC,MAAM;;;;;;;;;;;8CAGzB,8OAAC;oCAAG,WAAU;8CAAqC;;;;;;8CACnD,8OAAC;oCAAE,WAAU;8CACR;;;;;;8CAGL,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CACG,SAAS;4CACT,UAAU;4CACV,WAAU;sDAET;;;;;;sDAEL,8OAAC;4CACG,SAAS;4CACT,UAAU;4CACV,WAAW,CAAC,8EAA8E,EAAE,WACtF,wDACA,yDACD,gDAAgD,CAAC;sDAErD,YAAY,kBAAkB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASnE"}},
    {"offset": {"line": 224, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/hooks/useKeyboardShortcuts.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\n\r\ninterface UseKeyboardShortcutsProps {\r\n    onEscape?: () => void;\r\n    onDelete?: () => void;\r\n    onNew?: () => void;\r\n    onSearch?: () => void;\r\n    enabled?: boolean;\r\n}\r\n\r\nexport function useKeyboardShortcuts({\r\n    onEscape,\r\n    onDelete,\r\n    onNew,\r\n    onSearch,\r\n    enabled = true,\r\n}: UseKeyboardShortcutsProps) {\r\n    useEffect(() => {\r\n        if (!enabled) return;\r\n\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            // Don't trigger shortcuts when typing in inputs\r\n            const target = e.target as HTMLElement;\r\n            const isTyping = ['INPUT', 'TEXTAREA'].includes(target.tagName);\r\n\r\n            // Escape - always works\r\n            if (e.key === 'Escape' && onEscape) {\r\n                e.preventDefault();\r\n                onEscape();\r\n                return;\r\n            }\r\n\r\n            // Don't run other shortcuts while typing\r\n            if (isTyping) return;\r\n\r\n            // Ctrl/Cmd + K - Search\r\n            if ((e.ctrlKey || e.metaKey) && e.key === 'k' && onSearch) {\r\n                e.preventDefault();\r\n                onSearch();\r\n                return;\r\n            }\r\n\r\n            // Delete key\r\n            if (e.key === 'Delete' && onDelete) {\r\n                e.preventDefault();\r\n                onDelete();\r\n                return;\r\n            }\r\n\r\n            // N - New task\r\n            if (e.key === 'n' && onNew) {\r\n                e.preventDefault();\r\n                onNew();\r\n                return;\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [enabled, onEscape, onDelete, onNew, onSearch]);\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AAaO,SAAS,qBAAqB,EACjC,QAAQ,EACR,QAAQ,EACR,KAAK,EACL,QAAQ,EACR,UAAU,IAAI,EACU;IACxB,IAAA,kNAAS,EAAC;QACN,IAAI,CAAC,SAAS;QAEd,MAAM,gBAAgB,CAAC;YACnB,gDAAgD;YAChD,MAAM,SAAS,EAAE,MAAM;YACvB,MAAM,WAAW;gBAAC;gBAAS;aAAW,CAAC,QAAQ,CAAC,OAAO,OAAO;YAE9D,wBAAwB;YACxB,IAAI,EAAE,GAAG,KAAK,YAAY,UAAU;gBAChC,EAAE,cAAc;gBAChB;gBACA;YACJ;YAEA,yCAAyC;YACzC,IAAI,UAAU;YAEd,wBAAwB;YACxB,IAAI,CAAC,EAAE,OAAO,IAAI,EAAE,OAAO,KAAK,EAAE,GAAG,KAAK,OAAO,UAAU;gBACvD,EAAE,cAAc;gBAChB;gBACA;YACJ;YAEA,aAAa;YACb,IAAI,EAAE,GAAG,KAAK,YAAY,UAAU;gBAChC,EAAE,cAAc;gBAChB;gBACA;YACJ;YAEA,eAAe;YACf,IAAI,EAAE,GAAG,KAAK,OAAO,OAAO;gBACxB,EAAE,cAAc;gBAChB;gBACA;YACJ;QACJ;QAEA,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;IACvD,GAAG;QAAC;QAAS;QAAU;QAAU;QAAO;KAAS;AACrD"}},
    {"offset": {"line": 282, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/components/TaskDetail.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { TaskWithData } from '@/lib/types';\r\nimport { Calendar, FileText, Share2, MoreVertical, X, CheckSquare, Clock, User, Trash2 } from 'lucide-react';\r\nimport { deleteTask, updateTaskStatus } from '@/app/actions';\r\nimport { cn } from '@/lib/utils';\r\nimport { useRouter } from 'next/navigation';\r\nimport { toast } from 'sonner';\r\n\r\nimport ConfirmationModal from './ConfirmationModal';\r\nimport { useState } from 'react';\r\nimport { useKeyboardShortcuts } from '@/hooks/useKeyboardShortcuts';\r\n\r\nexport default function TaskDetail({ task, onClose }: { task: TaskWithData; onClose: () => void }) {\r\n    const router = useRouter();\r\n    const sender = task.sender || { name: 'Unknown', email: 'unknown@example.com' };\r\n    const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);\r\n    const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n    const handleDeleteClick = () => {\r\n        setIsDeleteModalOpen(true);\r\n    };\r\n\r\n    const handleConfirmDelete = async () => {\r\n        setIsDeleting(true);\r\n        const loadingToast = toast.loading('Deleting task...');\r\n\r\n        try {\r\n            console.log('Deleting task:', task.id);\r\n            const result = await deleteTask(task.id);\r\n\r\n            if (result.success) {\r\n                toast.success('Task deleted', { id: loadingToast });\r\n                router.refresh();\r\n                onClose();\r\n            } else {\r\n                toast.error(result.error || 'Failed to delete', { id: loadingToast });\r\n            }\r\n        } catch (error) {\r\n            console.error('Delete error:', error);\r\n            toast.error('An error occurred', { id: loadingToast });\r\n        } finally {\r\n            setIsDeleting(false);\r\n            setIsDeleteModalOpen(false);\r\n        }\r\n    };\r\n\r\n    useKeyboardShortcuts({\r\n        onEscape: onClose,\r\n        onDelete: handleDeleteClick,\r\n        enabled: !isDeleteModalOpen\r\n    });\r\n\r\n    return (\r\n        <>\r\n            <ConfirmationModal\r\n                isOpen={isDeleteModalOpen}\r\n                onClose={() => setIsDeleteModalOpen(false)}\r\n                onConfirm={handleConfirmDelete}\r\n                title=\"Delete Task\"\r\n                message=\"Are you sure you want to delete this task? This action cannot be undone.\"\r\n                confirmText=\"Delete Task\"\r\n                isDanger\r\n                isLoading={isDeleting}\r\n            />\r\n\r\n            <div className=\"flex flex-col h-full text-foreground\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between p-6 border-b border-white/10 glass bg-white/5\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-2 bg-blue-500/20 rounded-lg text-blue-400\">\r\n                            <FileText size={24} />\r\n                        </div>\r\n                        <div>\r\n                            <h2 className=\"text-xl font-semibold leading-none\">{task.title}</h2>\r\n                            <p className=\"text-sm text-muted-foreground mt-1\">From: {sender.name} &lt;{sender.email}&gt;</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <button\r\n                            onClick={handleDeleteClick}\r\n                            className=\"p-2 hover:bg-white/10 rounded-full transition-colors text-red-400\"\r\n                            title=\"Delete Task (Delete)\"\r\n                        >\r\n                            <Trash2 size={20} />\r\n                        </button>\r\n                        <button\r\n                            onClick={async () => {\r\n                                const loadingToast = toast.loading('Updating task...');\r\n\r\n                                try {\r\n                                    const result = await updateTaskStatus(task.id, 'completed');\r\n                                    if (result.success) {\r\n                                        toast.success('Task marked as done', { id: loadingToast });\r\n                                        router.refresh();\r\n                                        onClose();\r\n                                    } else {\r\n                                        toast.error(result.error || 'Failed to update', { id: loadingToast });\r\n                                    }\r\n                                } catch (error) {\r\n                                    console.error('Update error:', error);\r\n                                    toast.error('An error occurred', { id: loadingToast });\r\n                                }\r\n                            }}\r\n                            className=\"p-2 hover:bg-white/10 rounded-full transition-colors text-emerald-400\"\r\n                            title=\"Mark as Done\"\r\n                        >\r\n                            <CheckSquare size={20} />\r\n                        </button>\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"p-2 hover:bg-white/10 rounded-full transition-colors\"\r\n                        >\r\n                            <X size={20} />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Body */}\r\n                <div className=\"flex-1 overflow-y-auto p-8 relative\">\r\n                    {/* Metadata Badges */}\r\n                    <div className=\"flex gap-2 mb-6\">\r\n                        {task.tags?.map(tag => (\r\n                            <span key={tag} className=\"px-3 py-1 rounded-full text-xs font-medium bg-white/5 border border-white/10 text-white/70\">\r\n                                {tag}\r\n                            </span>\r\n                        ))}\r\n                        <span className=\"px-3 py-1 rounded-full text-xs font-medium bg-blue-500/10 border border-blue-500/20 text-blue-300 flex items-center gap-1\">\r\n                            <Calendar size={12} /> {(() => {\r\n                                try {\r\n                                    const d = new Date(task.createdAt);\r\n                                    return isNaN(d.getTime()) ? 'Recently' : d.toLocaleDateString();\r\n                                } catch (e) {\r\n                                    return 'Recently';\r\n                                }\r\n                            })()}\r\n                        </span>\r\n                        <span className={cn(\r\n                            \"px-3 py-1 rounded-full text-xs font-medium flex items-center gap-1\",\r\n                            task.status === 'completed' ? \"bg-emerald-500/10 border-emerald-500/20 text-emerald-400\" : \"bg-zinc-500/10 border-zinc-500/20 text-zinc-400\"\r\n                        )}>\r\n                            {task.status === 'completed' ? <CheckSquare size={12} /> : <Clock size={12} />}\r\n                            {task.status.charAt(0).toUpperCase() + task.status.slice(1)}\r\n                        </span>\r\n                    </div>\r\n\r\n                    <div className=\"prose prose-invert max-w-none text-white/80\">\r\n                        <p className=\"whitespace-pre-wrap leading-relaxed\">{task.description || task.preview}</p>\r\n                    </div>\r\n\r\n                    {/* Mock Actions Area - \"Workflow Triggers\" */}\r\n                    <div className=\"mt-12 p-6 rounded-xl border border-dashed border-white/20 bg-white/5\">\r\n                        <h3 className=\"text-sm font-medium text-muted-foreground mb-4 uppercase tracking-wider\">Suggested Workflows</h3>\r\n\r\n                        <div className=\"flex gap-4\">\r\n                            <button className=\"flex items-center gap-3 px-4 py-3 bg-emerald-500/10 hover:bg-emerald-500/20 border border-emerald-500/20 rounded-lg transition-all group\">\r\n                                <div className=\"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400 group-hover:scale-110 transition-transform\">\r\n                                    <FileText size={16} />\r\n                                </div>\r\n                                <div className=\"text-left\">\r\n                                    <div className=\"text-sm font-semibold text-emerald-100\">Create Sheet Task</div>\r\n                                    <div className=\"text-xs text-emerald-400/60\">Using AI Summary</div>\r\n                                </div>\r\n                            </button>\r\n\r\n                            <button className=\"flex items-center gap-3 px-4 py-3 bg-purple-500/10 hover:bg-purple-500/20 border border-purple-500/20 rounded-lg transition-all group\">\r\n                                <div className=\"w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-400 group-hover:scale-110 transition-transform\">\r\n                                    <Calendar size={16} />\r\n                                </div>\r\n                                <div className=\"text-left\">\r\n                                    <div className=\"text-sm font-semibold text-purple-100\">Schedule Meeting</div>\r\n                                    <div className=\"text-xs text-purple-400/60\">Find time in Calendar</div>\r\n                                </div>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 736, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA+PsB,yBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,0DAAA"}},
    {"offset": {"line": 750, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/components/DevTools.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Terminal, Send, X, Sparkles } from 'lucide-react';\r\nimport { simulateIncomingEmail } from '@/app/actions';\r\nimport { toast } from 'sonner';\r\n\r\nexport default function DevTools() {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [emailData, setEmailData] = useState({\r\n        from: 'client@example.com',\r\n        subject: 'Urgent: Invoice pending for Q1 Design Work',\r\n        body: 'Hi there,\\n\\nJust checking in on the invoice #1023 for the design work we completed last week. Please let me know if you need anything else.\\n\\nThanks,\\nSarah'\r\n    });\r\n\r\n    const handleSimulate = async () => {\r\n        setIsLoading(true);\r\n        const loadingToast = toast.loading('Receiving email...');\r\n\r\n        try {\r\n            const result = await simulateIncomingEmail(emailData);\r\n            if (result.success) {\r\n                toast.success('New task created from email!', { id: loadingToast });\r\n                setIsOpen(false);\r\n            } else {\r\n                toast.error('Failed to simulate', { id: loadingToast });\r\n            }\r\n        } catch (e) {\r\n            toast.error('Error simulating email', { id: loadingToast });\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed top-24 right-8 z-[9999]\">\r\n            <AnimatePresence>\r\n                {isOpen ? (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, scale: 0.9, y: 20 }}\r\n                        animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                        exit={{ opacity: 0, scale: 0.9, y: 20 }}\r\n                        className=\"bg-zinc-900 border border-white/10 rounded-xl shadow-2xl p-4 w-80 glass\"\r\n                    >\r\n                        <div className=\"flex justify-between items-center mb-4\">\r\n                            <h3 className=\"text-sm font-bold text-white flex items-center gap-2\">\r\n                                <Terminal size={14} className=\"text-purple-400\" />\r\n                                Email Simulator\r\n                            </h3>\r\n                            <button onClick={() => setIsOpen(false)} className=\"text-white/50 hover:text-white\">\r\n                                <X size={14} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3\">\r\n                            <input\r\n                                value={emailData.from}\r\n                                onChange={e => setEmailData({ ...emailData, from: e.target.value })}\r\n                                placeholder=\"From\"\r\n                                className=\"w-full bg-white/5 border border-white/10 rounded px-2 py-1 text-xs text-white\"\r\n                            />\r\n                            <input\r\n                                value={emailData.subject}\r\n                                onChange={e => setEmailData({ ...emailData, subject: e.target.value })}\r\n                                placeholder=\"Subject\"\r\n                                className=\"w-full bg-white/5 border border-white/10 rounded px-2 py-1 text-xs text-white font-medium\"\r\n                            />\r\n                            <textarea\r\n                                value={emailData.body}\r\n                                onChange={e => setEmailData({ ...emailData, body: e.target.value })}\r\n                                placeholder=\"Body\"\r\n                                rows={4}\r\n                                className=\"w-full bg-white/5 border border-white/10 rounded px-2 py-1 text-xs text-white resize-none\"\r\n                            />\r\n\r\n                            <button\r\n                                onClick={handleSimulate}\r\n                                disabled={isLoading}\r\n                                className=\"w-full bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold py-2 rounded flex items-center justify-center gap-2 transition-colors\"\r\n                            >\r\n                                {isLoading ? <Sparkles size={12} className=\"animate-spin\" /> : <Send size={12} />}\r\n                                Simulate Incoming Email\r\n                            </button>\r\n                        </div>\r\n                    </motion.div>\r\n                ) : (\r\n                    <motion.button\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        whileHover={{ scale: 1.05 }}\r\n                        onClick={() => setIsOpen(true)}\r\n                        className=\"bg-zinc-900 border border-white/10 text-purple-400 p-3 rounded-full shadow-xl\"\r\n                    >\r\n                        <Terminal size={20} />\r\n                    </motion.button>\r\n                )}\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AANA;;;;;;;AAQe,SAAS;IACpB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;QACvC,MAAM;QACN,SAAS;QACT,MAAM;IACV;IAEA,MAAM,iBAAiB;QACnB,aAAa;QACb,MAAM,eAAe,iJAAK,CAAC,OAAO,CAAC;QAEnC,IAAI;YACA,MAAM,SAAS,MAAM,IAAA,2KAAqB,EAAC;YAC3C,IAAI,OAAO,OAAO,EAAE;gBAChB,iJAAK,CAAC,OAAO,CAAC,gCAAgC;oBAAE,IAAI;gBAAa;gBACjE,UAAU;YACd,OAAO;gBACH,iJAAK,CAAC,KAAK,CAAC,sBAAsB;oBAAE,IAAI;gBAAa;YACzD;QACJ,EAAE,OAAO,GAAG;YACR,iJAAK,CAAC,KAAK,CAAC,0BAA0B;gBAAE,IAAI;YAAa;QAC7D,SAAU;YACN,aAAa;QACjB;IACJ;IAEA,qBACI,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC,4MAAe;sBACX,uBACG,8OAAC,oMAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS;oBAAG,OAAO;oBAAK,GAAG;gBAAG;gBACzC,SAAS;oBAAE,SAAS;oBAAG,OAAO;oBAAG,GAAG;gBAAE;gBACtC,MAAM;oBAAE,SAAS;oBAAG,OAAO;oBAAK,GAAG;gBAAG;gBACtC,WAAU;;kCAEV,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAG,WAAU;;kDACV,8OAAC,sNAAQ;wCAAC,MAAM;wCAAI,WAAU;;;;;;oCAAoB;;;;;;;0CAGtD,8OAAC;gCAAO,SAAS,IAAM,UAAU;gCAAQ,WAAU;0CAC/C,cAAA,8OAAC,iMAAC;oCAAC,MAAM;;;;;;;;;;;;;;;;;kCAIjB,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCACG,OAAO,UAAU,IAAI;gCACrB,UAAU,CAAA,IAAK,aAAa;wCAAE,GAAG,SAAS;wCAAE,MAAM,EAAE,MAAM,CAAC,KAAK;oCAAC;gCACjE,aAAY;gCACZ,WAAU;;;;;;0CAEd,8OAAC;gCACG,OAAO,UAAU,OAAO;gCACxB,UAAU,CAAA,IAAK,aAAa;wCAAE,GAAG,SAAS;wCAAE,SAAS,EAAE,MAAM,CAAC,KAAK;oCAAC;gCACpE,aAAY;gCACZ,WAAU;;;;;;0CAEd,8OAAC;gCACG,OAAO,UAAU,IAAI;gCACrB,UAAU,CAAA,IAAK,aAAa;wCAAE,GAAG,SAAS;wCAAE,MAAM,EAAE,MAAM,CAAC,KAAK;oCAAC;gCACjE,aAAY;gCACZ,MAAM;gCACN,WAAU;;;;;;0CAGd,8OAAC;gCACG,SAAS;gCACT,UAAU;gCACV,WAAU;;oCAET,0BAAY,8OAAC,sNAAQ;wCAAC,MAAM;wCAAI,WAAU;;;;;6DAAoB,8OAAC,0MAAI;wCAAC,MAAM;;;;;;oCAAO;;;;;;;;;;;;;;;;;;qCAM9F,8OAAC,oMAAM,CAAC,MAAM;gBACV,SAAS;oBAAE,SAAS;gBAAE;gBACtB,SAAS;oBAAE,SAAS;gBAAE;gBACtB,YAAY;oBAAE,OAAO;gBAAK;gBAC1B,SAAS,IAAM,UAAU;gBACzB,WAAU;0BAEV,cAAA,8OAAC,sNAAQ;oBAAC,MAAM;;;;;;;;;;;;;;;;;;;;;AAMxC"}},
    {"offset": {"line": 984, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/components/Layout.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, createContext, useContext } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { cn } from '@/lib/utils';\r\nimport { TaskWithData } from '@/lib/types';\r\nimport TaskDetail from './TaskDetail';\r\nimport DevTools from './DevTools';\r\n\r\ntype FocusContextType = {\r\n    isFocused: boolean;\r\n    focusedItem: TaskWithData | null;\r\n    setFocusedItem: (item: TaskWithData | null) => void;\r\n};\r\n\r\nconst FocusContext = createContext<FocusContextType | undefined>(undefined);\r\n\r\nexport function useFocus() {\r\n    const context = useContext(FocusContext);\r\n    if (!context) {\r\n        throw new Error('useFocus must be used within a FocusProvider');\r\n    }\r\n    return context;\r\n}\r\n\r\nexport default function Layout({ children }: { children: React.ReactNode }) {\r\n    const [focusedItem, setFocusedItemState] = useState<TaskWithData | null>(null);\r\n\r\n    const isFocused = !!focusedItem;\r\n\r\n    const setFocusedItem = (item: TaskWithData | null) => {\r\n        setFocusedItemState(item);\r\n    };\r\n\r\n    return (\r\n        <FocusContext.Provider value={{ isFocused, focusedItem, setFocusedItem }}>\r\n            <div className=\"relative min-h-screen overflow-hidden bg-background text-foreground transition-colors duration-500 font-sans selection:bg-primary/30\">\r\n\r\n                {/* Background Ambient Glows */}\r\n                <div className=\"fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0\">\r\n                    <div className=\"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-600/10 rounded-full blur-[120px] opacity-40 animate-pulse\" />\r\n                    <div className=\"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-purple-600/10 rounded-full blur-[120px] opacity-40 animate-pulse delay-1000\" />\r\n                    <div className=\"absolute top-[40%] left-[40%] w-[20%] h-[20%] bg-emerald-500/5 rounded-full blur-[100px] opacity-30\" />\r\n                </div>\r\n\r\n                {/* Focus Mode Overlay Backdrop */}\r\n                <AnimatePresence>\r\n                    {isFocused && (\r\n                        <motion.div\r\n                            initial={{ opacity: 0, backdropFilter: 'blur(0px)' }}\r\n                            animate={{ opacity: 1, backdropFilter: 'blur(16px)' }}\r\n                            exit={{ opacity: 0, backdropFilter: 'blur(0px)' }}\r\n                            transition={{ duration: 0.6, ease: [0.16, 1, 0.3, 1] }}\r\n                            className=\"fixed inset-0 z-40 bg-background/80 pointer-events-none\"\r\n                        />\r\n                    )}\r\n                </AnimatePresence>\r\n\r\n                {/* Main Content Layer */}\r\n                <div className={cn(\r\n                    \"relative z-10 transition-all duration-700 cubic-bezier(0.16, 1, 0.3, 1) h-screen flex flex-col\",\r\n                    isFocused ? \"scale-90 opacity-40 pointer-events-none blur-sm\" : \"opacity-100\"\r\n                )}>\r\n                    {/* Navbar */}\r\n                    <header className=\"flex items-center justify-between px-8 py-6 sticky top-0 z-20\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-purple-500 shadow-lg shadow-blue-500/20 flex items-center justify-center font-bold text-white\">\r\n                                T\r\n                            </div>\r\n                            <span className=\"text-lg font-bold tracking-tight text-white\">TaskFlow</span>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-6\">\r\n                            <nav className=\"hidden md:flex gap-6 text-sm font-medium text-white/60\">\r\n                                <a href=\"#\" className=\"hover:text-white transition-colors\">Dashboard</a>\r\n                                <a href=\"#\" className=\"text-white transition-colors\">Inbox</a>\r\n                                <a href=\"#\" className=\"hover:text-white transition-colors\">Calendar</a>\r\n                            </nav>\r\n                            <div className=\"w-px h-6 bg-white/10\" />\r\n                            <div className=\"w-8 h-8 rounded-full bg-white/10 border border-white/10 hover:border-white/30 transition-colors cursor-pointer\" />\r\n                        </div>\r\n                    </header>\r\n\r\n                    <main className=\"flex-1 overflow-auto p-4 md:p-8 max-w-6xl mx-auto w-full\">\r\n                        {children}\r\n                    </main>\r\n                </div>\r\n\r\n                {/* Focus Mode Modal Layer */}\r\n                <AnimatePresence>\r\n                    {focusedItem && (\r\n                        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 md:p-12\">\r\n                            <motion.div\r\n                                initial={{ opacity: 0, scale: 0.95, y: 40 }}\r\n                                animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                                exit={{ opacity: 0, scale: 0.95, y: 40 }}\r\n                                transition={{ type: \"spring\", stiffness: 350, damping: 30 }}\r\n                                className=\"w-full max-w-5xl h-full max-h-[85vh] glass-card rounded-3xl overflow-hidden shadow-2xl ring-1 ring-white/10 relative\"\r\n                            >\r\n                                <TaskDetail task={focusedItem} onClose={() => setFocusedItem(null)} />\r\n                            </motion.div>\r\n                        </div>\r\n                    )}\r\n                </AnimatePresence>\r\n\r\n                <DevTools />\r\n\r\n            </div>\r\n        </FocusContext.Provider >\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAAA;AACA;AAEA;AACA;AAPA;;;;;;;AAeA,MAAM,6BAAe,IAAA,sNAAa,EAA+B;AAE1D,SAAS;IACZ,MAAM,UAAU,IAAA,mNAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACV,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX;AAEe,SAAS,OAAO,EAAE,QAAQ,EAAiC;IACtE,MAAM,CAAC,aAAa,oBAAoB,GAAG,IAAA,iNAAQ,EAAsB;IAEzE,MAAM,YAAY,CAAC,CAAC;IAEpB,MAAM,iBAAiB,CAAC;QACpB,oBAAoB;IACxB;IAEA,qBACI,8OAAC,aAAa,QAAQ;QAAC,OAAO;YAAE;YAAW;YAAa;QAAe;kBACnE,cAAA,8OAAC;YAAI,WAAU;;8BAGX,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAI,WAAU;;;;;;sCACf,8OAAC;4BAAI,WAAU;;;;;;sCACf,8OAAC;4BAAI,WAAU;;;;;;;;;;;;8BAInB,8OAAC,4MAAe;8BACX,2BACG,8OAAC,oMAAM,CAAC,GAAG;wBACP,SAAS;4BAAE,SAAS;4BAAG,gBAAgB;wBAAY;wBACnD,SAAS;4BAAE,SAAS;4BAAG,gBAAgB;wBAAa;wBACpD,MAAM;4BAAE,SAAS;4BAAG,gBAAgB;wBAAY;wBAChD,YAAY;4BAAE,UAAU;4BAAK,MAAM;gCAAC;gCAAM;gCAAG;gCAAK;6BAAE;wBAAC;wBACrD,WAAU;;;;;;;;;;;8BAMtB,8OAAC;oBAAI,WAAW,IAAA,yHAAE,EACd,kGACA,YAAY,oDAAoD;;sCAGhE,8OAAC;4BAAO,WAAU;;8CACd,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAI,WAAU;sDAAsJ;;;;;;sDAGrK,8OAAC;4CAAK,WAAU;sDAA8C;;;;;;;;;;;;8CAGlE,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAI,WAAU;;8DACX,8OAAC;oDAAE,MAAK;oDAAI,WAAU;8DAAqC;;;;;;8DAC3D,8OAAC;oDAAE,MAAK;oDAAI,WAAU;8DAA+B;;;;;;8DACrD,8OAAC;oDAAE,MAAK;oDAAI,WAAU;8DAAqC;;;;;;;;;;;;sDAE/D,8OAAC;4CAAI,WAAU;;;;;;sDACf,8OAAC;4CAAI,WAAU;;;;;;;;;;;;;;;;;;sCAIvB,8OAAC;4BAAK,WAAU;sCACX;;;;;;;;;;;;8BAKT,8OAAC,4MAAe;8BACX,6BACG,8OAAC;wBAAI,WAAU;kCACX,cAAA,8OAAC,oMAAM,CAAC,GAAG;4BACP,SAAS;gCAAE,SAAS;gCAAG,OAAO;gCAAM,GAAG;4BAAG;4BAC1C,SAAS;gCAAE,SAAS;gCAAG,OAAO;gCAAG,GAAG;4BAAE;4BACtC,MAAM;gCAAE,SAAS;gCAAG,OAAO;gCAAM,GAAG;4BAAG;4BACvC,YAAY;gCAAE,MAAM;gCAAU,WAAW;gCAAK,SAAS;4BAAG;4BAC1D,WAAU;sCAEV,cAAA,8OAAC,2IAAU;gCAAC,MAAM;gCAAa,SAAS,IAAM,eAAe;;;;;;;;;;;;;;;;;;;;;8BAM7E,8OAAC,yIAAQ;;;;;;;;;;;;;;;;AAKzB"}},
    {"offset": {"line": 1270, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/components/ContextMenu.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ninterface ContextMenuItem {\r\n    label: string;\r\n    icon?: React.ReactNode;\r\n    onClick: () => void;\r\n    danger?: boolean;\r\n    className?: string; // Add className property to ContextMenuItem interface\r\n}\r\n\r\ninterface ContextMenuProps {\r\n    x: number;\r\n    y: number;\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    items: ContextMenuItem[];\r\n}\r\n\r\nexport default function ContextMenu({ x, y, isOpen, onClose, items }: ContextMenuProps) {\r\n    const menuRef = useRef<HTMLDivElement>(null);\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const handleClickOutside = (e: MouseEvent) => {\r\n            if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\r\n                onClose();\r\n            }\r\n        };\r\n\r\n        if (isOpen) {\r\n            window.addEventListener('click', handleClickOutside);\r\n            window.addEventListener('contextmenu', (e) => {\r\n                // Close if clicking right click elsewhere\r\n                if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\r\n                    onClose();\r\n                }\r\n            });\r\n        }\r\n\r\n        return () => {\r\n            window.removeEventListener('click', handleClickOutside);\r\n            window.removeEventListener('contextmenu', handleClickOutside);\r\n        };\r\n    }, [isOpen, onClose]);\r\n\r\n    // Prevent menu from going off-screen\r\n    const style = {\r\n        top: Math.min(y, typeof window !== 'undefined' ? window.innerHeight - 300 : y),\r\n        left: Math.min(x, typeof window !== 'undefined' ? window.innerWidth - 200 : x),\r\n    };\r\n\r\n    if (!mounted) return null;\r\n\r\n    return createPortal(\r\n        <AnimatePresence>\r\n            {isOpen && (\r\n                <motion.div\r\n                    ref={menuRef}\r\n                    initial={{ opacity: 0, scale: 0.95 }}\r\n                    animate={{ opacity: 1, scale: 1 }}\r\n                    exit={{ opacity: 0, scale: 0.95 }}\r\n                    transition={{ duration: 0.1 }}\r\n                    style={{ position: 'fixed', top: style.top, left: style.left, zIndex: 9999 }}\r\n                    className=\"min-w-[180px] bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl overflow-hidden py-1\"\r\n                >\r\n                    {items.map((item, index) => (\r\n                        <button\r\n                            key={index}\r\n                            onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                item.onClick();\r\n                                onClose();\r\n                            }}\r\n                            className={`w-full px-4 py-2.5 text-left text-sm flex items-center gap-3 transition-colors ${item.danger\r\n                                ? 'text-red-400 hover:bg-red-500/10'\r\n                                : 'text-white/80 hover:text-white hover:bg-white/10'\r\n                                } ${item.className || ''}`}\r\n                        >\r\n                            {item.icon && <span className=\"opacity-70\">{item.icon}</span>}\r\n                            {item.label}\r\n                        </button>\r\n                    ))}\r\n                </motion.div>\r\n            )}\r\n        </AnimatePresence>,\r\n        document.body\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAJA;;;;;AAsBe,SAAS,YAAY,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAoB;IAClF,MAAM,UAAU,IAAA,+MAAM,EAAiB;IACvC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACN,WAAW;IACf,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACN,MAAM,qBAAqB,CAAC;YACxB,IAAI,QAAQ,OAAO,IAAI,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,EAAE,MAAM,GAAW;gBAChE;YACJ;QACJ;QAEA,IAAI,QAAQ;YACR,OAAO,gBAAgB,CAAC,SAAS;YACjC,OAAO,gBAAgB,CAAC,eAAe,CAAC;gBACpC,0CAA0C;gBAC1C,IAAI,QAAQ,OAAO,IAAI,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,EAAE,MAAM,GAAW;oBAChE;gBACJ;YACJ;QACJ;QAEA,OAAO;YACH,OAAO,mBAAmB,CAAC,SAAS;YACpC,OAAO,mBAAmB,CAAC,eAAe;QAC9C;IACJ,GAAG;QAAC;QAAQ;KAAQ;IAEpB,qCAAqC;IACrC,MAAM,QAAQ;QACV,KAAK,KAAK,GAAG,CAAC,GAAG,sCAAgC,0BAA2B;QAC5E,MAAM,KAAK,GAAG,CAAC,GAAG,sCAAgC,0BAA0B;IAChF;IAEA,IAAI,CAAC,SAAS,OAAO;IAErB,qBAAO,IAAA,4NAAY,gBACf,8OAAC,4MAAe;kBACX,wBACG,8OAAC,oMAAM,CAAC,GAAG;YACP,KAAK;YACL,SAAS;gBAAE,SAAS;gBAAG,OAAO;YAAK;YACnC,SAAS;gBAAE,SAAS;gBAAG,OAAO;YAAE;YAChC,MAAM;gBAAE,SAAS;gBAAG,OAAO;YAAK;YAChC,YAAY;gBAAE,UAAU;YAAI;YAC5B,OAAO;gBAAE,UAAU;gBAAS,KAAK,MAAM,GAAG;gBAAE,MAAM,MAAM,IAAI;gBAAE,QAAQ;YAAK;YAC3E,WAAU;sBAET,MAAM,GAAG,CAAC,CAAC,MAAM,sBACd,8OAAC;oBAEG,SAAS,CAAC;wBACN,EAAE,eAAe;wBACjB,KAAK,OAAO;wBACZ;oBACJ;oBACA,WAAW,CAAC,+EAA+E,EAAE,KAAK,MAAM,GAClG,qCACA,mDACD,CAAC,EAAE,KAAK,SAAS,IAAI,IAAI;;wBAE7B,KAAK,IAAI,kBAAI,8OAAC;4BAAK,WAAU;sCAAc,KAAK,IAAI;;;;;;wBACpD,KAAK,KAAK;;mBAZN;;;;;;;;;;;;;;cAkBzB,SAAS,IAAI;AAErB"}},
    {"offset": {"line": 1382, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/components/InboxTable.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { MOCK_EMAILS, Email } from '@/lib/mockData';\r\nimport { useFocus } from './Layout';\r\nimport { toast } from 'sonner';\r\nimport { useRouter } from 'next/navigation';\r\nimport { deleteTask, updateTaskStatus } from '@/app/actions';\r\nimport ConfirmationModal from './ConfirmationModal';\r\nimport ContextMenu from './ContextMenu';\r\nimport { Mail, Paperclip, ChevronRight, User, Trash2, CheckSquare, FileText } from 'lucide-react';\r\nimport { Task } from '@prisma/client';\r\nimport { cn } from '@/lib/utils';\r\nimport { useKeyboardShortcuts } from '@/hooks/useKeyboardShortcuts';\r\n\r\ninterface InboxTableProps {\r\n    tasks: Task[];\r\n}\r\n\r\nexport default function InboxTable({ tasks }: InboxTableProps) {\r\n    const router = useRouter();\r\n    const { setFocusedItem } = useFocus();\r\n    const searchInputRef = useRef<HTMLInputElement>(null);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [activeFilter, setActiveFilter] = useState<'All' | 'Unread' | 'Campaigns'>('All');\r\n\r\n    // Context Menu & Modal State\r\n    const [contextMenu, setContextMenu] = useState<{ x: number; y: number; task: Task } | null>(null);\r\n    const [deletingTaskId, setDeletingTaskId] = useState<string | null>(null);\r\n    const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n    useKeyboardShortcuts({\r\n        onSearch: () => searchInputRef.current?.focus(),\r\n        onEscape: () => {\r\n            setContextMenu(null);\r\n            setDeletingTaskId(null);\r\n        },\r\n        enabled: !deletingTaskId\r\n    });\r\n\r\n    // Close menu when clicking outside\r\n    React.useEffect(() => {\r\n        const handleClickOutside = () => setContextMenu(null);\r\n        window.addEventListener('click', handleClickOutside);\r\n        return () => window.removeEventListener('click', handleClickOutside);\r\n    }, []);\r\n\r\n    const handleContextMenu = (e: React.MouseEvent, task: Task) => {\r\n        e.preventDefault();\r\n        setContextMenu({ x: e.clientX, y: e.clientY, task });\r\n    };\r\n\r\n    const handleDeleteRequest = (id: string) => {\r\n        setDeletingTaskId(id);\r\n        setContextMenu(null);\r\n    };\r\n\r\n    const handleConfirmDelete = async () => {\r\n        if (!deletingTaskId) return;\r\n        setIsDeleting(true);\r\n        const loadingToast = toast.loading('Deleting task...');\r\n\r\n        try {\r\n            const result = await deleteTask(deletingTaskId);\r\n            if (result.success) {\r\n                toast.success('Task deleted', { id: loadingToast });\r\n                router.refresh();\r\n            } else {\r\n                toast.error(result.error || 'Failed to delete', { id: loadingToast });\r\n            }\r\n        } catch (error) {\r\n            toast.error('An error occurred', { id: loadingToast });\r\n        } finally {\r\n            setIsDeleting(false);\r\n            setDeletingTaskId(null);\r\n        }\r\n    };\r\n\r\n    const handleToggleStatus = async (task: Task) => {\r\n        const newStatus = task.status === 'completed' ? 'pending' : 'completed';\r\n        const loadingToast = toast.loading(newStatus === 'completed' ? 'Marking as done...' : 'Marking as pending...');\r\n\r\n        try {\r\n            const result = await updateTaskStatus(task.id, newStatus);\r\n            if (result.success) {\r\n                toast.success(newStatus === 'completed' ? 'Task completed' : 'Task marked as pending', { id: loadingToast });\r\n                router.refresh();\r\n            } else {\r\n                toast.error(result.error || 'Failed to update', { id: loadingToast });\r\n            }\r\n        } finally {\r\n            setContextMenu(null);\r\n        }\r\n    };\r\n\r\n    const formatDate = (date: Date | string) => {\r\n        try {\r\n            const d = new Date(date);\r\n            if (isNaN(d.getTime())) return 'Recently';\r\n            return d.toLocaleDateString();\r\n        } catch (e) {\r\n            return 'Recently';\r\n        }\r\n    };\r\n\r\n    // Helper to parse email source safely\r\n    const getEmailData = (task: Task) => {\r\n        try {\r\n            if (!task.emailSource) return {};\r\n            return JSON.parse(task.emailSource);\r\n        } catch (e) {\r\n            return {};\r\n        }\r\n    };\r\n\r\n    // ... filtering logic preserved below by not including it in replacement ... \r\n\r\n\r\n    const filteredTasks = tasks.filter(task => {\r\n        const fullTask = getEmailData(task);\r\n        const senderName = fullTask.sender?.name || 'Unknown';\r\n        const title = fullTask.title || task.title || '';\r\n        const description = fullTask.description || task.description || '';\r\n\r\n        // Search filter\r\n        const matchesSearch =\r\n            senderName.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n            title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n            description.toLowerCase().includes(searchQuery.toLowerCase());\r\n\r\n        if (!matchesSearch) return false;\r\n\r\n        // Status/Category filter\r\n        if (activeFilter === 'Unread') return task.status === 'unread';\r\n        if (activeFilter === 'Campaigns') return (fullTask.tags && fullTask.tags.length > 0);\r\n\r\n        return true;\r\n    });\r\n\r\n    return (\r\n        <div className=\"w-full space-y-4\">\r\n            <ContextMenu\r\n                isOpen={!!contextMenu}\r\n                onClose={() => setContextMenu(null)}\r\n                x={contextMenu?.x || 0}\r\n                y={contextMenu?.y || 0}\r\n                items={[\r\n                    {\r\n                        label: 'Open Task',\r\n                        icon: <FileText size={14} />,\r\n                        onClick: () => {\r\n                            if (contextMenu) {\r\n                                const fullTask = getEmailData(contextMenu.task);\r\n                                setFocusedItem({ ...contextMenu.task, ...fullTask });\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        label: contextMenu?.task.status === 'completed' ? 'Mark as Pending' : 'Mark as Done',\r\n                        icon: <CheckSquare size={14} />,\r\n                        onClick: () => {\r\n                            if (contextMenu) handleToggleStatus(contextMenu.task);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: 'Delete',\r\n                        icon: <Trash2 size={14} />,\r\n                        danger: true,\r\n                        onClick: () => {\r\n                            if (contextMenu) handleDeleteRequest(contextMenu.task.id);\r\n                        }\r\n                    }\r\n                ]}\r\n            />\r\n            <ConfirmationModal\r\n                isOpen={!!deletingTaskId}\r\n                onClose={() => setDeletingTaskId(null)}\r\n                onConfirm={handleConfirmDelete}\r\n                title=\"Delete Task\"\r\n                message=\"Are you sure you want to delete this task? This action cannot be undone.\"\r\n                confirmText=\"Delete Task\"\r\n                isDanger\r\n                isLoading={isDeleting}\r\n            />\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-white\">Inbox</h1>\r\n                    <p className=\"text-white/40 text-sm mt-1\">Manage your active tasks and communications</p>\r\n                </div>\r\n\r\n                <div className=\"flex flex-col sm:flex-row gap-4 items-center\">\r\n                    {/* Search Bar */}\r\n                    <div className=\"relative w-full sm:w-64\">\r\n                        <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 text-white/30\" size={16} />\r\n                        <input\r\n                            ref={searchInputRef}\r\n                            type=\"text\"\r\n                            placeholder=\"Search inbox... (Ctrl+K)\"\r\n                            value={searchQuery}\r\n                            onChange={(e) => setSearchQuery(e.target.value)}\r\n                            className=\"w-full bg-white/5 border border-white/10 rounded-xl pl-10 pr-4 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all placeholder:text-white/20\"\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Filter Tabs */}\r\n                    <div className=\"flex p-1 bg-white/5 border border-white/10 rounded-xl\">\r\n                        {['All', 'Unread', 'Campaigns'].map((filter) => (\r\n                            <button\r\n                                key={filter}\r\n                                onClick={() => setActiveFilter(filter as any)}\r\n                                className={cn(\r\n                                    \"px-4 py-1.5 rounded-lg text-xs font-medium transition-all\",\r\n                                    activeFilter === filter\r\n                                        ? \"bg-blue-600 text-white shadow-lg shadow-blue-500/20\"\r\n                                        : \"text-white/40 hover:text-white/70\"\r\n                                )}\r\n                            >\r\n                                {filter}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <motion.div\r\n                className=\"space-y-3\"\r\n                initial=\"hidden\"\r\n                animate=\"visible\"\r\n                variants={{\r\n                    hidden: { opacity: 0 },\r\n                    visible: { opacity: 1, transition: { staggerChildren: 0.1 } }\r\n                }}\r\n            >\r\n                <AnimatePresence mode='popLayout'>\r\n                    {filteredTasks.map((task) => {\r\n                        const fullTask = getEmailData(task) || {};\r\n                        const sender = fullTask.sender || { name: 'Unknown', email: '' };\r\n                        const tags = fullTask.tags || [];\r\n\r\n                        return (\r\n                            <motion.div\r\n                                layout\r\n                                key={task.id}\r\n                                initial={{ opacity: 0, y: 20 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                exit={{ opacity: 0, scale: 0.95 }}\r\n                                onContextMenu={(e) => handleContextMenu(e, task)}\r\n                                onClick={() => setFocusedItem({\r\n                                    ...task,\r\n                                    ...fullTask\r\n                                })}\r\n                                className={cn(\r\n                                    \"group relative flex items-center gap-4 p-4 rounded-xl cursor-pointer transition-all duration-300 border border-white/5 hover:border-white/10\",\r\n                                    \"bg-white/5 hover:bg-white/10 backdrop-blur-sm\",\r\n                                    task.status === 'unread' ? \"shadow-[0_0_15px_-5px_theme(colors.blue.500/0.3)]\" : \"\"\r\n                                )}\r\n                            >\r\n                                {/* Status Indicator */}\r\n                                <div className={cn(\"w-1.5 h-1.5 rounded-full\", task.status === 'unread' ? \"bg-blue-500\" : \"bg-white/20\")} />\r\n\r\n                                {/* Sender Avatar/Icon */}\r\n                                <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500/20 to-purple-500/20 flex items-center justify-center text-indigo-300 border border-white/10 shrink-0\">\r\n                                    {sender.avatar ? (\r\n                                        <User size={18} />\r\n                                    ) : (\r\n                                        <span className=\"font-semibold text-sm\">{sender.name?.[0] || '?'}</span>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* Content */}\r\n                                <div className=\"flex-1 min-w-0\">\r\n                                    <div className=\"flex items-center gap-2 mb-1\">\r\n                                        <span className={cn(\"text-sm font-medium truncate\", task.status === 'unread' ? \"text-white\" : \"text-white/70\")}>\r\n                                            {sender.name}\r\n                                        </span>\r\n                                        {/* Attachment indicator placeholder */}\r\n                                    </div>\r\n                                    <div className=\"text-sm font-semibold text-white/90 truncate\">{fullTask.title || task.title}</div>\r\n                                    <div className=\"text-xs text-white/50 truncate mt-0.5\">{fullTask.preview || fullTask.description || task.description}</div>\r\n                                </div>\r\n\r\n                                {/* Meta & Date */}\r\n                                <div className=\"flex flex-col items-end gap-2 shrink-0\">\r\n                                    {/* Use createdAt or email date if available */}\r\n                                    <span className=\"text-xs text-white/40 font-mono\">\r\n                                        {formatDate(task.createdAt)}\r\n                                    </span>\r\n                                    <div className=\"flex gap-1\">\r\n                                        {tags.slice(0, 1).map((tag: string) => (\r\n                                            <span key={tag} className=\"px-2 py-0.5 rounded-md text-[10px] bg-white/5 border border-white/10 text-white/60\">\r\n                                                {tag}\r\n                                            </span>\r\n                                        ))}\r\n                                        {tags.length > 1 && (\r\n                                            <span className=\"px-2 py-0.5 rounded-md text-[10px] bg-white/5 text-white/40\">+ {tags.length - 1}</span>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Hover Action */}\r\n                                <div className=\"absolute right-4 opacity-0 group-hover:opacity-100 transition-opacity translate-x-2 group-hover:translate-x-0\">\r\n                                    <ChevronRight className=\"text-white/50\" />\r\n                                </div>\r\n\r\n                            </motion.div>\r\n                        );\r\n                    })}\r\n                </AnimatePresence>\r\n            </motion.div>\r\n            {filteredTasks.length === 0 && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, y: 10 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    className=\"py-20 flex flex-col items-center justify-center text-white/20\"\r\n                >\r\n                    <Mail size={48} className=\"mb-4 opacity-10\" />\r\n                    <p className=\"text-lg font-medium\">No messages found</p>\r\n                    <p className=\"text-sm\">Try adjusting your search or filters</p>\r\n                    {searchQuery && (\r\n                        <button\r\n                            onClick={() => setSearchQuery('')}\r\n                            className=\"mt-4 text-blue-400 hover:text-blue-300 text-sm font-medium\"\r\n                        >\r\n                            Clear Search\r\n                        </button>\r\n                    )}\r\n                </motion.div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAdA;;;;;;;;;;;;;AAoBe,SAAS,WAAW,EAAE,KAAK,EAAmB;IACzD,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,EAAE,cAAc,EAAE,GAAG,IAAA,wIAAQ;IACnC,MAAM,iBAAiB,IAAA,+MAAM,EAAmB;IAChD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAiC;IAEjF,6BAA6B;IAC7B,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAA8C;IAC5F,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAgB;IACpE,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAE7C,IAAA,4JAAoB,EAAC;QACjB,UAAU,IAAM,eAAe,OAAO,EAAE;QACxC,UAAU;YACN,eAAe;YACf,kBAAkB;QACtB;QACA,SAAS,CAAC;IACd;IAEA,mCAAmC;IACnC,gNAAK,CAAC,SAAS,CAAC;QACZ,MAAM,qBAAqB,IAAM,eAAe;QAChD,OAAO,gBAAgB,CAAC,SAAS;QACjC,OAAO,IAAM,OAAO,mBAAmB,CAAC,SAAS;IACrD,GAAG,EAAE;IAEL,MAAM,oBAAoB,CAAC,GAAqB;QAC5C,EAAE,cAAc;QAChB,eAAe;YAAE,GAAG,EAAE,OAAO;YAAE,GAAG,EAAE,OAAO;YAAE;QAAK;IACtD;IAEA,MAAM,sBAAsB,CAAC;QACzB,kBAAkB;QAClB,eAAe;IACnB;IAEA,MAAM,sBAAsB;QACxB,IAAI,CAAC,gBAAgB;QACrB,cAAc;QACd,MAAM,eAAe,iJAAK,CAAC,OAAO,CAAC;QAEnC,IAAI;YACA,MAAM,SAAS,MAAM,IAAA,gKAAU,EAAC;YAChC,IAAI,OAAO,OAAO,EAAE;gBAChB,iJAAK,CAAC,OAAO,CAAC,gBAAgB;oBAAE,IAAI;gBAAa;gBACjD,OAAO,OAAO;YAClB,OAAO;gBACH,iJAAK,CAAC,KAAK,CAAC,OAAO,KAAK,IAAI,oBAAoB;oBAAE,IAAI;gBAAa;YACvE;QACJ,EAAE,OAAO,OAAO;YACZ,iJAAK,CAAC,KAAK,CAAC,qBAAqB;gBAAE,IAAI;YAAa;QACxD,SAAU;YACN,cAAc;YACd,kBAAkB;QACtB;IACJ;IAEA,MAAM,qBAAqB,OAAO;QAC9B,MAAM,YAAY,KAAK,MAAM,KAAK,cAAc,YAAY;QAC5D,MAAM,eAAe,iJAAK,CAAC,OAAO,CAAC,cAAc,cAAc,uBAAuB;QAEtF,IAAI;YACA,MAAM,SAAS,MAAM,IAAA,sKAAgB,EAAC,KAAK,EAAE,EAAE;YAC/C,IAAI,OAAO,OAAO,EAAE;gBAChB,iJAAK,CAAC,OAAO,CAAC,cAAc,cAAc,mBAAmB,0BAA0B;oBAAE,IAAI;gBAAa;gBAC1G,OAAO,OAAO;YAClB,OAAO;gBACH,iJAAK,CAAC,KAAK,CAAC,OAAO,KAAK,IAAI,oBAAoB;oBAAE,IAAI;gBAAa;YACvE;QACJ,SAAU;YACN,eAAe;QACnB;IACJ;IAEA,MAAM,aAAa,CAAC;QAChB,IAAI;YACA,MAAM,IAAI,IAAI,KAAK;YACnB,IAAI,MAAM,EAAE,OAAO,KAAK,OAAO;YAC/B,OAAO,EAAE,kBAAkB;QAC/B,EAAE,OAAO,GAAG;YACR,OAAO;QACX;IACJ;IAEA,sCAAsC;IACtC,MAAM,eAAe,CAAC;QAClB,IAAI;YACA,IAAI,CAAC,KAAK,WAAW,EAAE,OAAO,CAAC;YAC/B,OAAO,KAAK,KAAK,CAAC,KAAK,WAAW;QACtC,EAAE,OAAO,GAAG;YACR,OAAO,CAAC;QACZ;IACJ;IAEA,8EAA8E;IAG9E,MAAM,gBAAgB,MAAM,MAAM,CAAC,CAAA;QAC/B,MAAM,WAAW,aAAa;QAC9B,MAAM,aAAa,SAAS,MAAM,EAAE,QAAQ;QAC5C,MAAM,QAAQ,SAAS,KAAK,IAAI,KAAK,KAAK,IAAI;QAC9C,MAAM,cAAc,SAAS,WAAW,IAAI,KAAK,WAAW,IAAI;QAEhE,gBAAgB;QAChB,MAAM,gBACF,WAAW,WAAW,GAAG,QAAQ,CAAC,YAAY,WAAW,OACzD,MAAM,WAAW,GAAG,QAAQ,CAAC,YAAY,WAAW,OACpD,YAAY,WAAW,GAAG,QAAQ,CAAC,YAAY,WAAW;QAE9D,IAAI,CAAC,eAAe,OAAO;QAE3B,yBAAyB;QACzB,IAAI,iBAAiB,UAAU,OAAO,KAAK,MAAM,KAAK;QACtD,IAAI,iBAAiB,aAAa,OAAQ,SAAS,IAAI,IAAI,SAAS,IAAI,CAAC,MAAM,GAAG;QAElF,OAAO;IACX;IAEA,qBACI,8OAAC;QAAI,WAAU;;0BACX,8OAAC,4IAAW;gBACR,QAAQ,CAAC,CAAC;gBACV,SAAS,IAAM,eAAe;gBAC9B,GAAG,aAAa,KAAK;gBACrB,GAAG,aAAa,KAAK;gBACrB,OAAO;oBACH;wBACI,OAAO;wBACP,oBAAM,8OAAC,0NAAQ;4BAAC,MAAM;;;;;;wBACtB,SAAS;4BACL,IAAI,aAAa;gCACb,MAAM,WAAW,aAAa,YAAY,IAAI;gCAC9C,eAAe;oCAAE,GAAG,YAAY,IAAI;oCAAE,GAAG,QAAQ;gCAAC;4BACtD;wBACJ;oBACJ;oBACA;wBACI,OAAO,aAAa,KAAK,WAAW,cAAc,oBAAoB;wBACtE,oBAAM,8OAAC,0OAAW;4BAAC,MAAM;;;;;;wBACzB,SAAS;4BACL,IAAI,aAAa,mBAAmB,YAAY,IAAI;wBACxD;oBACJ;oBACA;wBACI,OAAO;wBACP,oBAAM,8OAAC,oNAAM;4BAAC,MAAM;;;;;;wBACpB,QAAQ;wBACR,SAAS;4BACL,IAAI,aAAa,oBAAoB,YAAY,IAAI,CAAC,EAAE;wBAC5D;oBACJ;iBACH;;;;;;0BAEL,8OAAC,kJAAiB;gBACd,QAAQ,CAAC,CAAC;gBACV,SAAS,IAAM,kBAAkB;gBACjC,WAAW;gBACX,OAAM;gBACN,SAAQ;gBACR,aAAY;gBACZ,QAAQ;gBACR,WAAW;;;;;;0BAEf,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;;0CACG,8OAAC;gCAAG,WAAU;0CAAgC;;;;;;0CAC9C,8OAAC;gCAAE,WAAU;0CAA6B;;;;;;;;;;;;kCAG9C,8OAAC;wBAAI,WAAU;;0CAEX,8OAAC;gCAAI,WAAU;;kDACX,8OAAC,0MAAI;wCAAC,WAAU;wCAAyD,MAAM;;;;;;kDAC/E,8OAAC;wCACG,KAAK;wCACL,MAAK;wCACL,aAAY;wCACZ,OAAO;wCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;wCAC9C,WAAU;;;;;;;;;;;;0CAKlB,8OAAC;gCAAI,WAAU;0CACV;oCAAC;oCAAO;oCAAU;iCAAY,CAAC,GAAG,CAAC,CAAC,uBACjC,8OAAC;wCAEG,SAAS,IAAM,gBAAgB;wCAC/B,WAAW,IAAA,yHAAE,EACT,6DACA,iBAAiB,SACX,wDACA;kDAGT;uCATI;;;;;;;;;;;;;;;;;;;;;;0BAgBzB,8OAAC,oMAAM,CAAC,GAAG;gBACP,WAAU;gBACV,SAAQ;gBACR,SAAQ;gBACR,UAAU;oBACN,QAAQ;wBAAE,SAAS;oBAAE;oBACrB,SAAS;wBAAE,SAAS;wBAAG,YAAY;4BAAE,iBAAiB;wBAAI;oBAAE;gBAChE;0BAEA,cAAA,8OAAC,4MAAe;oBAAC,MAAK;8BACjB,cAAc,GAAG,CAAC,CAAC;wBAChB,MAAM,WAAW,aAAa,SAAS,CAAC;wBACxC,MAAM,SAAS,SAAS,MAAM,IAAI;4BAAE,MAAM;4BAAW,OAAO;wBAAG;wBAC/D,MAAM,OAAO,SAAS,IAAI,IAAI,EAAE;wBAEhC,qBACI,8OAAC,oMAAM,CAAC,GAAG;4BACP,MAAM;4BAEN,SAAS;gCAAE,SAAS;gCAAG,GAAG;4BAAG;4BAC7B,SAAS;gCAAE,SAAS;gCAAG,GAAG;4BAAE;4BAC5B,MAAM;gCAAE,SAAS;gCAAG,OAAO;4BAAK;4BAChC,eAAe,CAAC,IAAM,kBAAkB,GAAG;4BAC3C,SAAS,IAAM,eAAe;oCAC1B,GAAG,IAAI;oCACP,GAAG,QAAQ;gCACf;4BACA,WAAW,IAAA,yHAAE,EACT,gJACA,iDACA,KAAK,MAAM,KAAK,WAAW,sDAAsD;;8CAIrF,8OAAC;oCAAI,WAAW,IAAA,yHAAE,EAAC,4BAA4B,KAAK,MAAM,KAAK,WAAW,gBAAgB;;;;;;8CAG1F,8OAAC;oCAAI,WAAU;8CACV,OAAO,MAAM,iBACV,8OAAC,0MAAI;wCAAC,MAAM;;;;;6DAEZ,8OAAC;wCAAK,WAAU;kDAAyB,OAAO,IAAI,EAAE,CAAC,EAAE,IAAI;;;;;;;;;;;8CAKrE,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAI,WAAU;sDACX,cAAA,8OAAC;gDAAK,WAAW,IAAA,yHAAE,EAAC,gCAAgC,KAAK,MAAM,KAAK,WAAW,eAAe;0DACzF,OAAO,IAAI;;;;;;;;;;;sDAIpB,8OAAC;4CAAI,WAAU;sDAAgD,SAAS,KAAK,IAAI,KAAK,KAAK;;;;;;sDAC3F,8OAAC;4CAAI,WAAU;sDAAyC,SAAS,OAAO,IAAI,SAAS,WAAW,IAAI,KAAK,WAAW;;;;;;;;;;;;8CAIxH,8OAAC;oCAAI,WAAU;;sDAEX,8OAAC;4CAAK,WAAU;sDACX,WAAW,KAAK,SAAS;;;;;;sDAE9B,8OAAC;4CAAI,WAAU;;gDACV,KAAK,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,oBACnB,8OAAC;wDAAe,WAAU;kEACrB;uDADM;;;;;gDAId,KAAK,MAAM,GAAG,mBACX,8OAAC;oDAAK,WAAU;;wDAA8D;wDAAG,KAAK,MAAM,GAAG;;;;;;;;;;;;;;;;;;;8CAM3G,8OAAC;oCAAI,WAAU;8CACX,cAAA,8OAAC,sOAAY;wCAAC,WAAU;;;;;;;;;;;;2BA3DvB,KAAK,EAAE;;;;;oBAgExB;;;;;;;;;;;YAGP,cAAc,MAAM,KAAK,mBACtB,8OAAC,oMAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAG;gBAC7B,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAE;gBAC5B,WAAU;;kCAEV,8OAAC,0MAAI;wBAAC,MAAM;wBAAI,WAAU;;;;;;kCAC1B,8OAAC;wBAAE,WAAU;kCAAsB;;;;;;kCACnC,8OAAC;wBAAE,WAAU;kCAAU;;;;;;oBACtB,6BACG,8OAAC;wBACG,SAAS,IAAM,eAAe;wBAC9B,WAAU;kCACb;;;;;;;;;;;;;;;;;;AAQzB"}},
    {"offset": {"line": 1946, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA+IsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,8CAAA"}},
    {"offset": {"line": 1960, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA0FsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,8CAAA"}},
    {"offset": {"line": 1974, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAoKsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,8CAAA"}},
    {"offset": {"line": 1988, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA0MsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,4CAAA"}},
    {"offset": {"line": 2002, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA+NsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,8CAAA"}},
    {"offset": {"line": 2016, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA6OsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,mDAAA"}},
    {"offset": {"line": 2030, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MA4HsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,gDAAA"}},
    {"offset": {"line": 2044, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/components/FileManager.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Folder, FileText, Image as ImageIcon, UploadCloud, MoreVertical, Users, X, ChevronLeft, Maximize2, Edit2, Share2, Move, Trash2, Search, LayoutGrid, List } from 'lucide-react';\r\nimport type { WorkspaceFile } from '@prisma/client';\r\nimport { deleteFile, createFile, uploadFile, moveFile, renameFile, toggleFileShare, reorderFiles } from '@/app/actions';\r\nimport { useRouter } from 'next/navigation';\r\nimport { cn } from '@/lib/utils';\r\nimport { toast } from 'sonner';\r\nimport ConfirmationModal from './ConfirmationModal';\r\nimport ContextMenu from './ContextMenu';\r\nimport { useKeyboardShortcuts } from '@/hooks/useKeyboardShortcuts';\r\n\r\ninterface FileManagerProps {\r\n    files: WorkspaceFile[];\r\n}\r\n\r\n// Helper Component for Lazy Previews\r\nconst FilePreview = ({ file }: { file: WorkspaceFile }) => {\r\n    const [isLoaded, setIsLoaded] = useState(false);\r\n    const isImage = ['image', 'png', 'jpg', 'jpeg', 'webp', 'gif'].includes(file.type);\r\n\r\n    if (!isImage) {\r\n        return (\r\n            <div className=\"w-12 h-12 rounded-lg bg-gradient-to-br from-white/5 to-white/0 border border-white/5 flex items-center justify-center text-blue-300\">\r\n                {file.type === 'folder' && <Folder size={24} className=\"fill-blue-500/20 stroke-blue-400\" />}\r\n                {file.type === 'pdf' && <FileText size={24} className=\"text-red-400\" />}\r\n                {!['folder', 'pdf'].includes(file.type) && <FileText size={24} className=\"text-white/40\" />}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"w-full h-32 rounded-lg bg-black/20 relative overflow-hidden group-hover:shadow-lg transition-all border border-white/5\">\r\n            {/* Placeholder Icon (visible while loading) */}\r\n            <div className={cn(\r\n                \"absolute inset-0 flex items-center justify-center transition-opacity duration-500\",\r\n                isLoaded ? \"opacity-0\" : \"opacity-100\"\r\n            )}>\r\n                <ImageIcon size={24} className=\"text-white/20\" />\r\n            </div>\r\n\r\n            {/* Lazy Image */}\r\n            <img\r\n                src={`/uploads/${file.name}`}\r\n                alt={file.name}\r\n                loading=\"lazy\"\r\n                onLoad={() => setIsLoaded(true)}\r\n                className={cn(\r\n                    \"w-full h-full object-cover transition-all duration-700 transform hover:scale-110\",\r\n                    isLoaded ? \"opacity-100 blur-0\" : \"opacity-0 blur-lg\"\r\n                )}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default function FileManager({ files }: FileManagerProps) {\r\n    const router = useRouter();\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const searchInputRef = useRef<HTMLInputElement>(null);\r\n    const [currentFolderId, setCurrentFolderId] = useState<string | null>(null);\r\n    const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');\r\n    const [selectedFileIds, setSelectedFileIds] = useState<Set<string>>(new Set());\r\n    const [lastSelectedId, setLastSelectedId] = useState<string | null>(null);\r\n    const [previewFile, setPreviewFile] = useState<WorkspaceFile | null>(null);\r\n    const [activeMenuId, setActiveMenuId] = useState<string | null>(null);\r\n    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);\r\n    const [movingFiles, setMovingFiles] = useState<WorkspaceFile[] | null>(null);\r\n    const [renamingFile, setRenamingFile] = useState<WorkspaceFile | null>(null);\r\n    const [newFolderName, setNewFolderName] = useState('');\r\n    const [newNameValue, setNewNameValue] = useState('');\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [isDeleting, setIsDeleting] = useState(false);\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const [deletingId, setDeletingId] = useState<string | string[] | null>(null);\r\n\r\n    // Context Menu State\r\n    const [contextMenu, setContextMenu] = useState<{ x: number; y: number; file: WorkspaceFile } | null>(null);\r\n\r\n    // Drag and Drop State\r\n    const [dragOverFolderId, setDragOverFolderId] = useState<string | null>(null);\r\n    const [dragOverFileId, setDragOverFileId] = useState<string | null>(null);\r\n    const [reorderTarget, setReorderTarget] = useState<{ id: string; position: 'before' | 'after' } | null>(null);\r\n    const [groupingData, setGroupingData] = useState<{ sourceIds: string[]; targetId: string } | null>(null);\r\n    const [isCreatingGroup, setIsCreatingGroup] = useState(false);\r\n\r\n    const handleDragStart = (e: React.DragEvent, file: WorkspaceFile) => {\r\n        e.dataTransfer.setData('fileId', file.id);\r\n        e.dataTransfer.effectAllowed = 'move';\r\n    };\r\n\r\n    const handleDragOver = (e: React.DragEvent, folder: WorkspaceFile) => {\r\n        e.preventDefault();\r\n        e.stopPropagation(); // Stop bubbling to global handler\r\n        e.dataTransfer.dropEffect = 'move';\r\n        if (dragOverFolderId !== folder.id) {\r\n            setDragOverFolderId(folder.id);\r\n        }\r\n    };\r\n\r\n    const handleDragLeave = (e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setDragOverFolderId(null);\r\n    };\r\n\r\n    const handleDrop = async (e: React.DragEvent, targetFolder: WorkspaceFile) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setDragOverFolderId(null);\r\n        setIsGlobalDragActive(false); // Ensure global overlay is closed\r\n\r\n        // 1. Handle External File Upload\r\n        if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {\r\n            const files = Array.from(e.dataTransfer.files);\r\n            const loadingToast = toast.loading(`Uploading ${files.length} file(s) to ${targetFolder.name}...`);\r\n\r\n            try {\r\n                let successCount = 0;\r\n                for (const file of files) {\r\n                    const formData = new FormData();\r\n                    formData.append('file', file);\r\n                    formData.append('parentId', targetFolder.id);\r\n\r\n                    const result = await uploadFile(formData);\r\n                    if (result.success) successCount++;\r\n                }\r\n\r\n                if (successCount > 0) {\r\n                    toast.success(`Uploaded ${successCount} files`, { id: loadingToast });\r\n                    router.refresh();\r\n                } else {\r\n                    toast.error('Failed to upload files', { id: loadingToast });\r\n                }\r\n            } catch (error) {\r\n                toast.error('Error uploading files', { id: loadingToast });\r\n            }\r\n            return;\r\n        }\r\n\r\n        // 2. Handle Internal File Move\r\n        const fileId = e.dataTransfer.getData('fileId');\r\n        if (!fileId || fileId === targetFolder.id) return;\r\n\r\n        const loadingToast = toast.loading(`Moving to ${targetFolder.name}...`);\r\n\r\n        try {\r\n            const result = await moveFile(fileId, targetFolder.id);\r\n            if (result.success) {\r\n                toast.success('File moved', { id: loadingToast });\r\n                router.refresh();\r\n            } else {\r\n                toast.error('Failed to move', { id: loadingToast });\r\n            }\r\n        } catch (error) {\r\n            toast.error('Error moving file', { id: loadingToast });\r\n        }\r\n    };\r\n\r\n    const handleDragOverFile = (e: React.DragEvent, targetFile: WorkspaceFile) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (targetFile.type === 'folder') {\r\n            handleDragOver(e, targetFile);\r\n            setReorderTarget(null);\r\n            return;\r\n        }\r\n\r\n        e.dataTransfer.dropEffect = 'move';\r\n        setIsGlobalDragActive(false);\r\n\r\n        // Calculate drop position logic\r\n        const rect = e.currentTarget.getBoundingClientRect();\r\n        const isHorizontal = viewMode === 'grid'; // Grid drags left/right, List drags top/bottom usually\r\n\r\n        // However, grid flows left-to-right, top-to-bottom.\r\n        // Let's use a simple box logic:\r\n        // Center 50% = Group\r\n        // Left/Top 25% = Insert Before\r\n        // Right/Bottom 25% = Insert After\r\n\r\n        const x = e.clientX - rect.left;\r\n        const y = e.clientY - rect.top;\r\n        const w = rect.width;\r\n        const h = rect.height;\r\n\r\n        const isLeft = x < w * 0.25;\r\n        const isRight = x > w * 0.75;\r\n        const isTop = y < h * 0.25;\r\n        const isBottom = y > h * 0.75;\r\n\r\n        // Priority to Grouping if in center\r\n        if (!isLeft && !isRight && !isTop && !isBottom) {\r\n            if (dragOverFileId !== targetFile.id) setDragOverFileId(targetFile.id);\r\n            setReorderTarget(null);\r\n            return;\r\n        }\r\n\r\n        // Reorder logic\r\n        setDragOverFileId(null); // Clear grouping highlight\r\n\r\n        // Determine Before/After based on dominant axis\r\n        // In grid, X matters more usually, but Y matters too. \r\n        // Simple heuristic: If (Left or Top) -> Before. If (Right or Bottom) -> After.\r\n        // We refine this for \"Grid\" specifically.\r\n\r\n        let position: 'before' | 'after' = 'after'; // default\r\n\r\n        if (viewMode === 'list') {\r\n            if (y < h / 2) position = 'before';\r\n        } else {\r\n            // Grid\r\n            if (x < w / 2) position = 'before';\r\n        }\r\n\r\n        setReorderTarget({ id: targetFile.id, position });\r\n    };\r\n\r\n    const handleDropOnFile = async (e: React.DragEvent, targetFile: WorkspaceFile) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (targetFile.type === 'folder') {\r\n            handleDrop(e, targetFile);\r\n            return;\r\n        }\r\n\r\n        setDragOverFileId(null);\r\n        setIsGlobalDragActive(false);\r\n\r\n        const sourceId = e.dataTransfer.getData('fileId');\r\n        if (!sourceId || sourceId === targetFile.id) return;\r\n\r\n        // Determine if we are dragging a selection or a single file\r\n        let sourceIds: string[] = [sourceId];\r\n        if (selectedFileIds.has(sourceId)) {\r\n            sourceIds = Array.from(selectedFileIds);\r\n        }\r\n        // Filter out target (just in case)\r\n        sourceIds = sourceIds.filter(id => id !== targetFile.id);\r\n        if (sourceIds.length === 0) return;\r\n\r\n        // CHECK ACTION: Reorder or Group?\r\n        if (reorderTarget && reorderTarget.id === targetFile.id) {\r\n            // REORDER ACTION\r\n            const loadingToast = toast.loading('Reordering...');\r\n\r\n            // Calculate new order values\r\n            // 1. Find the target file's order\r\n            const targetIndex = filteredFiles.findIndex(f => f.id === targetFile.id);\r\n            if (targetIndex === -1) return;\r\n\r\n            const targetOrder = targetFile.order || 0;\r\n\r\n            // We need to insert these files \"around\" the target order.\r\n            // Since we can't easily shift everything in SQL without a heavy query, \r\n            // a robust \"spacing\" strategy or \"midpoint\" strategy is best.\r\n            // BUT for this MVP, let's just use midpoint between target and prev/next.\r\n\r\n            let newOrderStart = targetOrder;\r\n\r\n            if (reorderTarget.position === 'before') {\r\n                const prevFile = filteredFiles[targetIndex - 1];\r\n                const prevOrder = prevFile ? (prevFile.order || 0) : (targetOrder - 1000);\r\n                newOrderStart = (prevOrder + targetOrder) / 2;\r\n            } else {\r\n                const nextFile = filteredFiles[targetIndex + 1];\r\n                const nextOrder = nextFile ? (nextFile.order || 0) : (targetOrder + 1000);\r\n                newOrderStart = (targetOrder + nextOrder) / 2;\r\n            }\r\n\r\n            // Assign new orders to dragged files\r\n            // We give them slight increments to keep their relative order if multiple\r\n            const updates = sourceIds.map((id, index) => ({\r\n                id,\r\n                order: newOrderStart + (index * 0.01) // smooth small increment\r\n            }));\r\n\r\n            try {\r\n                await reorderFiles(updates);\r\n                toast.success('Reordered', { id: loadingToast });\r\n                router.refresh();\r\n                setReorderTarget(null);\r\n                setSelectedFileIds(new Set());\r\n            } catch (err) {\r\n                toast.error('Failed to reorder', { id: loadingToast });\r\n            }\r\n\r\n        } else {\r\n            // GROUPING ACTION (Existing Logic)\r\n            setGroupingData({ sourceIds, targetId: targetFile.id });\r\n            setNewFolderName(''); // Reset name\r\n        }\r\n    };\r\n\r\n    const handleCreateGroup = async (e?: React.FormEvent) => {\r\n        e?.preventDefault();\r\n        if (!groupingData) return;\r\n\r\n        // Default name logic\r\n        const nameToUse = newFolderName.trim() || `Group ${new Date().toLocaleDateString()}`;\r\n\r\n        setIsCreatingGroup(true);\r\n        const loadingToast = toast.loading('Creating group...');\r\n\r\n        try {\r\n            // 1. Create New Folder\r\n            // We need the ID, so we assume createFile has been updated to return it.\r\n            // If the TypeScript interface isn't updated, we might get a type error here, \r\n            // but the runtime will work if the action was updated.\r\n            const createResult: any = await createFile({\r\n                name: nameToUse,\r\n                type: 'folder',\r\n                items: '0 items',\r\n                parentId: currentFolderId || undefined\r\n            });\r\n\r\n            if (!createResult.success || !createResult.file) {\r\n                throw new Error(createResult.error || 'Failed to create folder');\r\n            }\r\n\r\n            const newFolderId = createResult.file.id;\r\n\r\n            // 2. Move Source & Target Files\r\n            const allFilesToMove = [...groupingData.sourceIds, groupingData.targetId];\r\n\r\n            // Deduplicate just in case\r\n            const uniqueFiles = Array.from(new Set(allFilesToMove));\r\n\r\n            for (const fileId of uniqueFiles) {\r\n                await moveFile(fileId, newFolderId);\r\n            }\r\n\r\n            toast.success('Group created!', { id: loadingToast });\r\n            setGroupingData(null);\r\n            setNewFolderName('');\r\n            router.refresh();\r\n            setSelectedFileIds(new Set());\r\n\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Failed to create group', { id: loadingToast });\r\n        } finally {\r\n            setIsCreatingGroup(false);\r\n        }\r\n    };\r\n\r\n    // Keyboard shortcuts\r\n    useKeyboardShortcuts({\r\n        onEscape: () => {\r\n            setActiveMenuId(null);\r\n            setContextMenu(null);\r\n            setPreviewFile(null);\r\n            setRenamingFile(null);\r\n            setIsCreateModalOpen(false);\r\n            setMovingFiles(null);\r\n            setIsCreateModalOpen(false);\r\n            setMovingFiles(null);\r\n            setGroupingData(null);\r\n            setDeletingId(null);\r\n        },\r\n        onSearch: () => {\r\n            searchInputRef.current?.focus();\r\n        },\r\n        enabled: !deletingId && !isCreateModalOpen\r\n    });\r\n\r\n    // Close menu when clicking outside\r\n    useEffect(() => {\r\n        const handleClickOutside = () => {\r\n            setActiveMenuId(null);\r\n            setContextMenu(null);\r\n        };\r\n        window.addEventListener('click', handleClickOutside);\r\n        return () => window.removeEventListener('click', handleClickOutside);\r\n    }, []);\r\n\r\n    const handleContextMenu = (e: React.MouseEvent, file: WorkspaceFile) => {\r\n        e.preventDefault();\r\n        e.stopPropagation(); // Stop propagation to prevent browser context menu AND parent handlers\r\n        setContextMenu({ x: e.clientX, y: e.clientY, file });\r\n        setActiveMenuId(null); // Close regular menu if open\r\n    };\r\n\r\n    const handleDeleteRequest = (id: string | string[]) => {\r\n        setDeletingId(id);\r\n        setActiveMenuId(null);\r\n    };\r\n\r\n    const handleConfirmDelete = async () => {\r\n        if (!deletingId) return;\r\n\r\n        setIsDeleting(true);\r\n        const idsToDelete = Array.isArray(deletingId) ? deletingId : [deletingId];\r\n        const loadingToast = toast.loading(`Deleting ${idsToDelete.length} item(s)...`);\r\n\r\n        try {\r\n            let successCount = 0;\r\n            for (const id of idsToDelete) {\r\n                const result = await deleteFile(id);\r\n                if (result.success) successCount++;\r\n            }\r\n\r\n            if (successCount === idsToDelete.length) {\r\n                toast.success('Deleted successfully', { id: loadingToast });\r\n                router.refresh();\r\n                setSelectedFileIds(new Set()); // Clear selection after delete\r\n            } else {\r\n                toast.error(`Failed to delete some items (${successCount}/${idsToDelete.length} deleted)`, { id: loadingToast });\r\n            }\r\n        } catch (error) {\r\n            console.error('Delete error:', error);\r\n            toast.error('An error occurred', { id: loadingToast });\r\n        } finally {\r\n            setIsDeleting(false);\r\n            setDeletingId(null);\r\n        }\r\n    };\r\n\r\n    const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        setIsUploading(true);\r\n        const loadingToast = toast.loading(`Uploading ${file.name}...`);\r\n\r\n        const formData = new FormData();\r\n        formData.append('file', file);\r\n        if (currentFolderId) {\r\n            formData.append('parentId', currentFolderId);\r\n        }\r\n\r\n        try {\r\n            const result = await uploadFile(formData);\r\n            if (result.success) {\r\n                toast.success('File uploaded successfully', { id: loadingToast });\r\n                router.refresh();\r\n            } else {\r\n                toast.error(result.error || 'Upload failed', { id: loadingToast });\r\n            }\r\n        } catch (error) {\r\n            toast.error('Upload failed', { id: loadingToast });\r\n        } finally {\r\n            setIsUploading(false);\r\n        }\r\n    };\r\n\r\n    const triggerUpload = () => {\r\n        fileInputRef.current?.click();\r\n    };\r\n\r\n    const handleCreateFolder = async (e?: React.FormEvent) => {\r\n        e?.preventDefault();\r\n        if (!newFolderName.trim()) {\r\n            toast.error('Folder name cannot be empty');\r\n            return;\r\n        }\r\n\r\n        const loadingToast = toast.loading('Creating folder...');\r\n\r\n        try {\r\n            const result = await createFile({\r\n                name: newFolderName.trim(),\r\n                type: 'folder',\r\n                items: '0 items',\r\n                parentId: currentFolderId || undefined\r\n            });\r\n\r\n            if (result.success) {\r\n                toast.success('Folder created', { id: loadingToast });\r\n                setNewFolderName('');\r\n                setIsCreateModalOpen(false);\r\n                router.refresh();\r\n            } else {\r\n                toast.error(result.error || 'Failed to create folder', { id: loadingToast });\r\n            }\r\n        } catch (error) {\r\n            toast.error('Failed to create folder', { id: loadingToast });\r\n        }\r\n    };\r\n\r\n    const handleRenameSubmit = async (e?: React.FormEvent) => {\r\n        e?.preventDefault();\r\n        if (!renamingFile || !newNameValue.trim() || newNameValue.trim() === renamingFile.name) {\r\n            setRenamingFile(null);\r\n            return;\r\n        }\r\n\r\n        const loadingToast = toast.loading('Renaming...');\r\n\r\n        try {\r\n            const result = await renameFile(renamingFile.id, newNameValue.trim());\r\n\r\n            if (result.success) {\r\n                toast.success('Renamed successfully', { id: loadingToast });\r\n                setRenamingFile(null);\r\n                setNewNameValue('');\r\n                router.refresh();\r\n            } else {\r\n                toast.error(result.error || 'Failed to rename', { id: loadingToast });\r\n            }\r\n        } catch (error) {\r\n            toast.error('Failed to rename', { id: loadingToast });\r\n        }\r\n    };\r\n\r\n    const startRename = (file: WorkspaceFile) => {\r\n        setRenamingFile(file);\r\n        setNewNameValue(file.name);\r\n        setActiveMenuId(null);\r\n    };\r\n\r\n    const handleToggleShare = async (file: WorkspaceFile) => {\r\n        const loadingToast = toast.loading(file.shared ? 'Unsharing...' : 'Sharing...');\r\n\r\n        try {\r\n            const result = await toggleFileShare(file.id);\r\n\r\n            if (result.success) {\r\n                toast.success(file.shared ? 'Unshared successfully' : 'Shared successfully', { id: loadingToast });\r\n                setActiveMenuId(null);\r\n                router.refresh();\r\n            } else {\r\n                toast.error(result.error || 'Failed to update', { id: loadingToast });\r\n            }\r\n        } catch (error) {\r\n            toast.error('Failed to update', { id: loadingToast });\r\n        }\r\n    };\r\n\r\n    const handleMove = async (targetFolderId: string | null) => {\r\n        if (!movingFiles || movingFiles.length === 0) return;\r\n\r\n        const loadingToast = toast.loading(`Moving ${movingFiles.length} item(s)...`);\r\n\r\n        try {\r\n            let successCount = 0;\r\n            for (const file of movingFiles) {\r\n                if (file.id === targetFolderId) continue;\r\n                const result = await moveFile(file.id, targetFolderId);\r\n                if (result.success) successCount++;\r\n            }\r\n\r\n            if (successCount > 0) {\r\n                toast.success(`Moved ${successCount} items successfully`, { id: loadingToast });\r\n                setMovingFiles(null);\r\n                setActiveMenuId(null);\r\n                setSelectedFileIds(new Set()); // Clear selection\r\n                router.refresh();\r\n            } else {\r\n                toast.error('Failed to move items', { id: loadingToast });\r\n            }\r\n        } catch (error) {\r\n            toast.error('Failed to move items', { id: loadingToast });\r\n        }\r\n    };\r\n\r\n    const filteredFiles = (searchQuery\r\n        ? files.filter(f => f.name.toLowerCase().includes(searchQuery.toLowerCase()))\r\n        : files.filter(f => f.parentId === currentFolderId)\r\n    ).sort((a, b) => (a.order || 0) - (b.order || 0)); // Sort by Order\r\n\r\n    const currentFolder = files.find(f => f.id === currentFolderId);\r\n    const folders = files.filter(f => f.type === 'folder');\r\n\r\n    const menuVariants = {\r\n        hidden: { opacity: 0, scale: 0.95, y: -10 },\r\n        visible: { opacity: 1, scale: 1, y: 0 }\r\n    };\r\n\r\n    // Global Drag State\r\n    const [isGlobalDragActive, setIsGlobalDragActive] = useState(false);\r\n\r\n    const handleGlobalDragOver = (e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // Check if dragging files (not just text selection)\r\n        if (e.dataTransfer.types && (e.dataTransfer.types.includes('Files') || e.dataTransfer.types.includes('application/x-moz-file'))) {\r\n            setIsGlobalDragActive(true);\r\n            e.dataTransfer.dropEffect = 'copy';\r\n        }\r\n    };\r\n\r\n    const handleGlobalDragLeave = (e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // Only set false if leaving the main container (relatedTarget check is complex in React, simplified for now)\r\n        if (e.currentTarget === e.target) {\r\n            setIsGlobalDragActive(false);\r\n        }\r\n    };\r\n\r\n    // Better approach for flickering drag leave: Use a counter or just overlay\r\n    // Actually, simply overlaying a div when active handles the events better.\r\n\r\n    const handleGlobalDrop = async (e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setIsGlobalDragActive(false);\r\n\r\n        // Only handle uploads\r\n        if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {\r\n            const droppedFiles = Array.from(e.dataTransfer.files);\r\n            const targetName = currentFolderId ? (files.find(f => f.id === currentFolderId)?.name || 'Current Folder') : 'Root';\r\n\r\n            const loadingToast = toast.loading(`Uploading ${droppedFiles.length} file(s) to ${targetName}...`);\r\n\r\n            try {\r\n                let successCount = 0;\r\n                for (const file of droppedFiles) {\r\n                    const formData = new FormData();\r\n                    formData.append('file', file);\r\n                    if (currentFolderId) {\r\n                        formData.append('parentId', currentFolderId);\r\n                    }\r\n\r\n                    const result = await uploadFile(formData);\r\n                    if (result.success) successCount++;\r\n                }\r\n\r\n                if (successCount > 0) {\r\n                    toast.success(`Uploaded ${successCount} files`, { id: loadingToast });\r\n                    router.refresh();\r\n                } else {\r\n                    toast.error('Failed to upload files', { id: loadingToast });\r\n                }\r\n            } catch (error) {\r\n                toast.error('Error uploading files', { id: loadingToast });\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleFileClick = (e: React.MouseEvent, fileId: string) => {\r\n        e.stopPropagation();\r\n\r\n        const newSelected = new Set(e.ctrlKey || e.metaKey ? selectedFileIds : []);\r\n\r\n        if (e.shiftKey && lastSelectedId) {\r\n            const currentIndex = filteredFiles.findIndex(f => f.id === fileId);\r\n            const lastIndex = filteredFiles.findIndex(f => f.id === lastSelectedId);\r\n\r\n            if (currentIndex !== -1 && lastIndex !== -1) {\r\n                const start = Math.min(currentIndex, lastIndex);\r\n                const end = Math.max(currentIndex, lastIndex);\r\n                for (let i = start; i <= end; i++) {\r\n                    newSelected.add(filteredFiles[i].id);\r\n                }\r\n            }\r\n        } else if (e.ctrlKey || e.metaKey) {\r\n            if (newSelected.has(fileId)) {\r\n                newSelected.delete(fileId);\r\n            } else {\r\n                newSelected.add(fileId);\r\n            }\r\n            setLastSelectedId(fileId);\r\n        } else {\r\n            newSelected.add(fileId);\r\n            setLastSelectedId(fileId);\r\n        }\r\n\r\n        setSelectedFileIds(newSelected);\r\n    };\r\n\r\n    const handleBackgroundClick = () => {\r\n        setSelectedFileIds(new Set());\r\n        setLastSelectedId(null);\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className=\"w-full space-y-6 relative min-h-[500px]\"\r\n            onDragOver={handleGlobalDragOver}\r\n            onDrop={handleGlobalDrop}\r\n            onClick={handleBackgroundClick}\r\n        >\r\n            {/* Global Drop Overlay - Purely Visual */}\r\n            <AnimatePresence>\r\n                {isGlobalDragActive && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        className=\"absolute inset-0 z-10 bg-blue-600/10 backdrop-blur-sm border-2 border-blue-500 border-dashed rounded-3xl flex flex-col items-center justify-center pointer-events-none\"\r\n                    >\r\n                        <div className=\"bg-zinc-900/90 p-6 rounded-2xl shadow-xl flex flex-col items-center animate-bounce\">\r\n                            <UploadCloud size={48} className=\"text-blue-400 mb-2\" />\r\n                            <h3 className=\"text-xl font-bold text-white\">Drop to Upload</h3>\r\n                            <p className=\"text-white/50\">Add files to {currentFolderId ? (files.find(f => f.id === currentFolderId)?.name) : 'Root'}</p>\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Overlay to catch the leave event triggers logic, but must not block folders.\r\n                Actually we don't need a separate capture div if we use the parent div for Drop.\r\n                But we do need to detect 'leave' from the parent.\r\n             */}\r\n            {isGlobalDragActive && (\r\n                <div\r\n                    className=\"absolute inset-0 z-0\"\r\n                    onDragLeave={() => setIsGlobalDragActive(false)}\r\n                />\r\n            )}\r\n\r\n\r\n            <ConfirmationModal\r\n                isOpen={!!deletingId}\r\n                onClose={() => setDeletingId(null)}\r\n                onConfirm={handleConfirmDelete}\r\n                title=\"Delete File\"\r\n                message=\"Are you sure you want to delete this file? This action cannot be undone.\"\r\n                confirmText=\"Delete File\"\r\n                isDanger\r\n                isLoading={isDeleting}\r\n            />\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    {currentFolderId && (\r\n                        <button\r\n                            onClick={() => setCurrentFolderId(currentFolder?.parentId || null)}\r\n                            className=\"p-2 hover:bg-white/10 rounded-full text-white/50 hover:text-white transition-colors\"\r\n                        >\r\n                            <ChevronLeft size={20} />\r\n                        </button>\r\n                    )}\r\n                    <h1 className=\"text-3xl font-bold text-white\">\r\n                        {searchQuery ? 'Search Results' : (currentFolderId ? currentFolder?.name : 'Files')}\r\n                    </h1>\r\n                </div>\r\n\r\n                <div className=\"flex-1 max-w-md mx-8 hidden lg:block\">\r\n                    <div className=\"relative\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-white/30\" size={16} />\r\n                        <input\r\n                            ref={searchInputRef}\r\n                            type=\"text\"\r\n                            placeholder=\"Search your files... (Ctrl+K)\"\r\n                            value={searchQuery}\r\n                            onChange={(e) => setSearchQuery(e.target.value)}\r\n                            className=\"w-full bg-white/5 border border-white/10 rounded-xl pl-10 pr-4 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all placeholder:text-white/20\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex gap-2\">\r\n                    <button\r\n                        onClick={() => setIsCreateModalOpen(true)}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-lg transition-colors text-sm font-medium border border-white/10\"\r\n                    >\r\n                        <Folder size={16} />\r\n                        <span>New Folder</span>\r\n                    </button>\r\n                    <button\r\n                        onClick={triggerUpload}\r\n                        className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors text-sm font-medium shadow-lg shadow-blue-500/20\"\r\n                    >\r\n                        <UploadCloud size={16} />\r\n                        <span>Upload File</span>\r\n                    </button>\r\n\r\n                    <div className=\"flex items-center bg-white/5 rounded-lg border border-white/10 p-1 ml-2\">\r\n                        <button\r\n                            onClick={() => setViewMode('grid')}\r\n                            className={cn(\r\n                                \"p-1.5 rounded-md transition-all\",\r\n                                viewMode === 'grid' ? \"bg-white/10 text-white shadow-sm\" : \"text-white/40 hover:text-white/80\"\r\n                            )}\r\n                            title=\"Grid View\"\r\n                        >\r\n                            <LayoutGrid size={18} />\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setViewMode('list')}\r\n                            className={cn(\r\n                                \"p-1.5 rounded-md transition-all\",\r\n                                viewMode === 'list' ? \"bg-white/10 text-white shadow-sm\" : \"text-white/40 hover:text-white/80\"\r\n                            )}\r\n                            title=\"List View\"\r\n                        >\r\n                            <List size={18} />\r\n                        </button>\r\n                    </div>\r\n                    <input\r\n                        type=\"file\"\r\n                        ref={fileInputRef}\r\n                        onChange={handleFileChange}\r\n                        className=\"hidden\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Drag Drop Zone (Keep it as explicit button/zone too) */}\r\n            <div\r\n                onClick={triggerUpload}\r\n                onDragOver={handleGlobalDragOver}\r\n                onDrop={handleGlobalDrop}\r\n                className=\"w-full h-32 border-2 border-dashed border-white/10 rounded-2xl flex flex-col items-center justify-center bg-white/5 hover:bg-white/10 transition-colors cursor-pointer group\"\r\n            >\r\n                <div className=\"p-3 rounded-full bg-white/5 group-hover:scale-110 transition-transform mb-2\">\r\n                    <UploadCloud className=\"text-white/50\" />\r\n                </div>\r\n                <p className=\"text-sm text-white/50\">Drag and drop files here to upload to {currentFolderId ? currentFolder?.name : 'root'}</p>\r\n            </div>\r\n\r\n            {/* Mobile Search */}\r\n            <div className=\"lg:hidden relative\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-white/30\" size={16} />\r\n                <input\r\n                    type=\"text\"\r\n                    placeholder=\"Search your files...\"\r\n                    value={searchQuery}\r\n                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                    className=\"w-full bg-white/5 border border-white/10 rounded-xl pl-10 pr-4 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all placeholder:text-white/20\"\r\n                />\r\n            </div>\r\n\r\n            {/* Path Breadcrumbs */}\r\n            <div className=\"flex items-center gap-2 text-sm text-white/50 mb-2 overflow-x-auto pb-2\">\r\n                <button\r\n                    onClick={() => setCurrentFolderId(null)}\r\n                    className={cn(\r\n                        \"hover:text-white transition-colors flex items-center gap-1\",\r\n                        !currentFolderId && \"text-white font-medium\"\r\n                    )}\r\n                >\r\n                    <Folder size={14} />\r\n                    <span>Home</span>\r\n                </button>\r\n                {currentFolderId && (\r\n                    <>\r\n                        <ChevronLeft size={12} className=\"rotate-180\" />\r\n                        <span className=\"text-white font-medium\">{currentFolder?.name}</span>\r\n                    </>\r\n                )}\r\n            </div>\r\n\r\n            {/* File Grid */}\r\n            {/* File Container */}\r\n            <div className={viewMode === 'grid' ? \"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\" : \"flex flex-col space-y-2\"}>\r\n                {filteredFiles.map((file, index) => (\r\n                    <motion.div\r\n                        key={file.id}\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: index * 0.05 }}\r\n                        onContextMenu={(e) => handleContextMenu(e, file)}\r\n                        draggable={true}\r\n                        onDragStart={(e: any) => handleDragStart(e, file)}\r\n                        onDragOver={(e) => handleDragOverFile(e, file)}\r\n                        onDragLeave={(e) => {\r\n                            if (file.type === 'folder') {\r\n                                handleDragLeave(e);\r\n                            } else {\r\n                                setDragOverFileId(null);\r\n                            }\r\n                        }}\r\n                        onDrop={(e) => handleDropOnFile(e, file)}\r\n                        onClick={(e) => handleFileClick(e, file.id)}\r\n                        onDoubleClick={(e) => {\r\n                            e.stopPropagation();\r\n                            if (file.type === 'folder') {\r\n                                setCurrentFolderId(file.id);\r\n                            } else {\r\n                                setPreviewFile(file);\r\n                            }\r\n                        }}\r\n                        className={cn(\r\n                            \"group relative cursor-pointer z-20 transition-all border\",\r\n                            viewMode === 'grid'\r\n                                ? \"p-4 rounded-xl\"\r\n                                : \"px-4 py-3 rounded-lg flex items-center gap-4\",\r\n                            selectedFileIds.has(file.id)\r\n                                ? \"ring-2 ring-blue-500 bg-blue-500/20 border-blue-500/50\"\r\n                                : \"bg-white/5 border-white/5 hover:bg-white/10 hover:border-white/10\",\r\n                            (dragOverFolderId === file.id || dragOverFileId === file.id) ? \"ring-2 ring-blue-500 bg-blue-500/20 scale-[1.05] z-30 shadow-xl shadow-blue-500/20\" : \"\"\r\n                        )}\r\n                    >\r\n                        {/* Reorder Indicators */}\r\n                        {reorderTarget?.id === file.id && reorderTarget.position === 'before' && (\r\n                            <div className={cn(\r\n                                \"absolute bg-blue-500 z-50 rounded-full\",\r\n                                viewMode === 'grid' ? \"left-0 top-0 bottom-0 w-1 shadow-[0_0_10px_#3b82f6]\" : \"top-0 left-0 right-0 h-1 shadow-[0_0_10px_#3b82f6]\"\r\n                            )} />\r\n                        )}\r\n                        {reorderTarget?.id === file.id && reorderTarget.position === 'after' && (\r\n                            <div className={cn(\r\n                                \"absolute bg-blue-500 z-50 rounded-full\",\r\n                                viewMode === 'grid' ? \"right-0 top-0 bottom-0 w-1 shadow-[0_0_10px_#3b82f6]\" : \"bottom-0 left-0 right-0 h-1 shadow-[0_0_10px_#3b82f6]\"\r\n                            )} />\r\n                        )}\r\n\r\n                        {viewMode === 'grid' ? (\r\n                            // GRID VIEW CARD\r\n                            <>\r\n                                <div className=\"flex flex-col gap-3 mb-2\">\r\n                                    <div className=\"flex justify-between items-start\">\r\n                                        {file.type === 'folder' ? (\r\n                                            <div className=\"p-3 rounded-lg bg-gradient-to-br from-blue-500/10 to-blue-600/5 border border-blue-500/20 text-blue-400\">\r\n                                                <Folder size={24} className=\"fill-blue-500/20\" />\r\n                                            </div>\r\n                                        ) : (\r\n                                            <FilePreview file={file} />\r\n                                        )}\r\n                                        <div className={cn(\"relative z-30\", file.type !== 'folder' ? \"absolute top-4 right-4\" : \"\")} onClick={(e) => e.stopPropagation()}>\r\n                                            <button\r\n                                                onClick={(e) => {\r\n                                                    e.preventDefault();\r\n                                                    e.stopPropagation();\r\n                                                    const rect = e.currentTarget.getBoundingClientRect();\r\n                                                    setContextMenu({ x: rect.left, y: rect.bottom + 5, file });\r\n                                                }}\r\n                                                className=\"p-1.5 rounded-md bg-black/20 hover:bg-black/60 backdrop-blur-sm text-white/50 hover:text-white transition-colors border border-white/5\"\r\n                                            >\r\n                                                <MoreVertical size={16} />\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <h3 className=\"text-sm font-medium text-white truncate px-1\">{file.name}</h3>\r\n                                    <div className=\"flex items-center justify-between text-xs text-white/40 px-1\">\r\n                                        <span>{file.type === 'folder' ? file.items : file.size}</span>\r\n                                        {file.shared && (\r\n                                            <div className=\"flex items-center gap-1 text-emerald-400/80 bg-emerald-500/10 px-1.5 py-0.5 rounded\">\r\n                                                <Users size={10} />\r\n                                                <span>Shared</span>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </>\r\n                        ) : (\r\n                            // LIST VIEW ROW\r\n                            <>\r\n                                {/* Icon Column */}\r\n                                <div className=\"flex-shrink-0\">\r\n                                    {file.type === 'folder' ? (\r\n                                        <div className=\"p-2 rounded-md bg-blue-500/10 text-blue-400\">\r\n                                            <Folder size={20} className=\"fill-blue-500/20\" />\r\n                                        </div>\r\n                                    ) : (\r\n                                        ['image', 'png', 'jpg', 'jpeg'].includes(file.type) ? (\r\n                                            <div className=\"w-9 h-9 rounded-md overflow-hidden bg-white/5\">\r\n                                                <img src={`/uploads/${file.name}`} className=\"w-full h-full object-cover\" alt=\"\" />\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className=\"p-2 rounded-md bg-white/5 text-white/40\">\r\n                                                <FileText size={20} />\r\n                                            </div>\r\n                                        )\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* Name Column */}\r\n                                <div className=\"flex-1 min-w-0 flex flex-col justify-center\">\r\n                                    <h3 className=\"text-sm font-medium text-white truncate\">{file.name}</h3>\r\n                                    <span className=\"text-xs text-white/30 lg:hidden\">\r\n                                        {file.type === 'folder' ? file.items : file.size}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                {/* Meta Columns (Desktop) */}\r\n                                <div className=\"hidden lg:flex items-center gap-8 text-sm text-white/40\">\r\n                                    <span className=\"w-24 text-right\">\r\n                                        {file.type === 'folder' ? file.items : file.size}\r\n                                    </span>\r\n                                    {file.shared && (\r\n                                        <div className=\"flex items-center gap-1 text-emerald-400/80 bg-emerald-500/10 px-1.5 py-0.5 rounded text-xs\">\r\n                                            <Users size={10} />\r\n                                            <span>Shared</span>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* Actions */}\r\n                                <div className=\"flex-shrink-0 ml-2\" onClick={(e) => e.stopPropagation()}>\r\n                                    <button\r\n                                        onClick={(e) => {\r\n                                            e.preventDefault();\r\n                                            e.stopPropagation();\r\n                                            const rect = e.currentTarget.getBoundingClientRect();\r\n                                            setContextMenu({ x: rect.left, y: rect.bottom + 5, file });\r\n                                        }}\r\n                                        className=\"p-1.5 rounded-md hover:bg-white/10 text-white/40 hover:text-white transition-colors\"\r\n                                    >\r\n                                        <MoreVertical size={16} />\r\n                                    </button>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                    </motion.div>\r\n                ))}\r\n\r\n                {/* Empty State */}\r\n                {filteredFiles.length === 0 && (\r\n                    <div className=\"col-span-full py-20 flex flex-col items-center justify-center text-white/20\">\r\n                        <Folder size={48} className=\"mb-4 opacity-20\" />\r\n                        <p className=\"text-lg font-medium\">No files found</p>\r\n                        <p className=\"text-sm\">{searchQuery ? 'Try a different search query' : 'This folder is empty'}</p>\r\n                        {searchQuery && (\r\n                            <button\r\n                                onClick={() => setSearchQuery('')}\r\n                                className=\"mt-4 text-blue-400 hover:text-blue-300 text-sm font-medium\"\r\n                            >\r\n                                Clear Search\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n\r\n            {/* ... Modals (Create Folder, Move, Rename, Preview) ... */}\r\n            <AnimatePresence>\r\n                {isCreateModalOpen && (\r\n                    <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\r\n                            onClick={() => setIsCreateModalOpen(false)}\r\n                        />\r\n                        <motion.div\r\n                            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                            className=\"relative w-full max-w-md glass-card rounded-2xl overflow-hidden border border-white/10 p-6 shadow-2xl\"\r\n                        >\r\n                            <h2 className=\"text-xl font-bold text-white mb-4\">Create New Folder</h2>\r\n                            <form onSubmit={handleCreateFolder} className=\"space-y-4\">\r\n                                <input\r\n                                    autoFocus\r\n                                    type=\"text\"\r\n                                    placeholder=\"Folder Name\"\r\n                                    value={newFolderName}\r\n                                    onChange={(e) => setNewFolderName(e.target.value)}\r\n                                    className=\"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50\"\r\n                                />\r\n                                <div className=\"flex justify-end gap-3\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setIsCreateModalOpen(false)}\r\n                                        className=\"px-4 py-2 text-white/50 hover:text-white transition-colors\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        className=\"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors font-medium shadow-lg shadow-blue-500/20\"\r\n                                    >\r\n                                        Create Folder\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Move File Modal */}\r\n            <AnimatePresence>\r\n                {movingFiles && (\r\n                    <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\r\n                            onClick={() => setMovingFiles(null)}\r\n                        />\r\n                        <motion.div\r\n                            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                            className=\"relative w-full max-w-md glass-card rounded-2xl overflow-hidden border border-white/10 p-6 shadow-2xl\"\r\n                        >\r\n                            <h2 className=\"text-xl font-bold text-white mb-4 flex items-center gap-2\">\r\n                                <Move size={20} className=\"text-blue-400\" />\r\n                                {movingFiles.length > 1\r\n                                    ? `Move ${movingFiles.length} items`\r\n                                    : `Move \"${movingFiles[0].name}\"`\r\n                                }\r\n                            </h2>\r\n                            <div className=\"max-h-[300px] overflow-y-auto space-y-1 mb-6\">\r\n                                <button\r\n                                    onClick={() => handleMove(null)}\r\n                                    className=\"w-full p-3 text-left hover:bg-white/5 rounded-lg flex items-center gap-3 text-white/70 transition-colors\"\r\n                                >\r\n                                    <div className=\"w-8 h-8 rounded bg-white/5 flex items-center justify-center\">\r\n                                        <Folder size={16} />\r\n                                    </div>\r\n                                    <span>Root Directory</span>\r\n                                </button>\r\n                                {folders\r\n                                    .filter(f => !movingFiles.find(mf => mf.id === f.id)) // Don't show folders that are being moved (can't move folder into itself)\r\n                                    .map(folder => (\r\n                                        <button\r\n                                            key={folder.id}\r\n                                            onClick={() => handleMove(folder.id)}\r\n                                            className=\"w-full p-3 text-left hover:bg-white/5 rounded-lg flex items-center gap-3 text-white/70 transition-colors\"\r\n                                        >\r\n                                            <div className=\"w-8 h-8 rounded bg-blue-500/10 flex items-center justify-center text-blue-400\">\r\n                                                <Folder size={16} className=\"fill-blue-500/20\" />\r\n                                            </div>\r\n                                            <span>{folder.name}</span>\r\n                                        </button>\r\n                                    ))}\r\n                            </div>\r\n                            <div className=\"flex justify-end\">\r\n                                <button\r\n                                    onClick={() => setMovingFiles(null)}\r\n                                    className=\"px-4 py-2 text-white/50 hover:text-white transition-colors\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                            </div>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Grouping Modal */}\r\n            <AnimatePresence>\r\n                {groupingData && (\r\n                    <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\r\n                            onClick={() => setGroupingData(null)}\r\n                        />\r\n                        <motion.div\r\n                            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                            className=\"relative w-full max-w-md glass-card rounded-2xl overflow-hidden border border-white/10 p-6 shadow-2xl\"\r\n                        >\r\n                            <h2 className=\"text-xl font-bold text-white mb-4\">Create New Group</h2>\r\n                            <p className=\"text-sm text-white/50 mb-4\">\r\n                                Enter a name for the new folder that will contain the selected files.\r\n                            </p>\r\n                            <form onSubmit={handleCreateGroup} className=\"space-y-4\">\r\n                                <input\r\n                                    autoFocus\r\n                                    type=\"text\"\r\n                                    placeholder=\"Folder Name (e.g., Vacation Photos)\"\r\n                                    value={newFolderName}\r\n                                    onChange={(e) => setNewFolderName(e.target.value)}\r\n                                    className=\"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50\"\r\n                                />\r\n                                <div className=\"flex justify-between items-center\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setNewFolderName('Group ' + new Date().toISOString().split('T')[0])}\r\n                                        className=\"text-xs text-blue-400 hover:text-blue-300 transition-colors\"\r\n                                    >\r\n                                        Auto-generate Name\r\n                                    </button>\r\n                                </div>\r\n                                <div className=\"flex justify-end gap-3 pt-2\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setGroupingData(null)}\r\n                                        className=\"px-4 py-2 text-white/50 hover:text-white transition-colors\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        disabled={isCreatingGroup}\r\n                                        className=\"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors font-medium shadow-lg shadow-blue-500/20 disabled:opacity-50\"\r\n                                    >\r\n                                        {isCreatingGroup ? 'Creating...' : 'Create Group'}\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Rename Modal */}\r\n            <AnimatePresence>\r\n                {renamingFile && (\r\n                    <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\r\n                            onClick={() => setRenamingFile(null)}\r\n                        />\r\n                        <motion.div\r\n                            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                            className=\"relative w-full max-w-md glass-card rounded-2xl overflow-hidden border border-white/10 p-6 shadow-2xl\"\r\n                        >\r\n                            <h2 className=\"text-xl font-bold text-white mb-4 flex items-center gap-2\">\r\n                                <Edit2 size={20} className=\"text-blue-400\" />\r\n                                Rename \"{renamingFile.name}\"\r\n                            </h2>\r\n                            <form onSubmit={handleRenameSubmit} className=\"space-y-4\">\r\n                                <input\r\n                                    autoFocus\r\n                                    type=\"text\"\r\n                                    placeholder=\"New Name\"\r\n                                    value={newNameValue}\r\n                                    onChange={(e) => setNewNameValue(e.target.value)}\r\n                                    className=\"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50\"\r\n                                />\r\n                                <div className=\"flex justify-end gap-3\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setRenamingFile(null)}\r\n                                        className=\"px-4 py-2 text-white/50 hover:text-white transition-colors\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        className=\"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors font-medium shadow-lg shadow-blue-500/20\"\r\n                                    >\r\n                                        Rename\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Preview Modal */}\r\n            <AnimatePresence>\r\n                {previewFile && (\r\n                    <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"absolute inset-0 bg-black/90 backdrop-blur-md\"\r\n                            onClick={() => setPreviewFile(null)}\r\n                        />\r\n                        <motion.div\r\n                            initial={{ opacity: 0, scale: 0.95 }}\r\n                            animate={{ opacity: 1, scale: 1 }}\r\n                            exit={{ opacity: 0, scale: 0.95 }}\r\n                            className=\"relative w-full max-w-4xl bg-zinc-900 rounded-2xl overflow-hidden border border-white/10 shadow-2xl\"\r\n                        >\r\n                            <div className=\"flex items-center justify-between p-4 border-b border-white/5\">\r\n                                <h2 className=\"text-white font-medium\">{previewFile.name}</h2>\r\n                                <button\r\n                                    onClick={() => setPreviewFile(null)}\r\n                                    className=\"p-2 hover:bg-white/10 rounded-full text-white/50 hover:text-white transition-colors\"\r\n                                >\r\n                                    <X size={20} />\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"p-8 flex items-center justify-center min-h-[400px]\">\r\n                                {previewFile.type === 'image' || ['png', 'jpg', 'jpeg', 'webp'].includes(previewFile.type) ? (\r\n                                    <img\r\n                                        src={`/uploads/${previewFile.name}`}\r\n                                        alt={previewFile.name}\r\n                                        className=\"max-w-full max-h-[70vh] object-contain rounded-lg\"\r\n                                    />\r\n                                ) : previewFile.type === 'pdf' ? (\r\n                                    <iframe\r\n                                        src={`/uploads/${previewFile.name}`}\r\n                                        className=\"w-full h-[70vh] rounded-lg border-0 bg-white\"\r\n                                    />\r\n                                ) : (\r\n                                    <div className=\"text-center space-y-4\">\r\n                                        <FileText size={64} className=\"mx-auto text-white/20\" />\r\n                                        <p className=\"text-white/50\">Preview not available for this file type</p>\r\n                                        <a\r\n                                            href={`/uploads/${previewFile.name}`}\r\n                                            download\r\n                                            className=\"inline-block px-6 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors\"\r\n                                        >\r\n                                            Download File\r\n                                        </a>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {\r\n                contextMenu && (\r\n                    <ContextMenu\r\n                        x={contextMenu.x}\r\n                        y={contextMenu.y}\r\n                        isOpen={!!contextMenu}\r\n                        onClose={() => setContextMenu(null)}\r\n                        items={[\r\n                            {\r\n                                label: 'Open',\r\n                                icon: <Maximize2 size={16} />,\r\n                                onClick: () => {\r\n                                    if (contextMenu.file.type === 'folder') {\r\n                                        setCurrentFolderId(contextMenu.file.id);\r\n                                    } else {\r\n                                        setPreviewFile(contextMenu.file);\r\n                                    }\r\n                                }\r\n                            },\r\n                            {\r\n                                label: 'Rename',\r\n                                icon: <Edit2 size={16} />,\r\n                                onClick: () => startRename(contextMenu.file)\r\n                            },\r\n                            {\r\n                                label: contextMenu.file.shared ? 'Unshare' : 'Share',\r\n                                icon: <Share2 size={16} />,\r\n                                onClick: () => handleToggleShare(contextMenu.file)\r\n                            },\r\n                            {\r\n                                label: 'Move to...',\r\n                                icon: <Move size={16} />,\r\n                                onClick: () => {\r\n                                    if (selectedFileIds.size > 1 && selectedFileIds.has(contextMenu.file.id)) {\r\n                                        const selectedFiles = files.filter(f => selectedFileIds.has(f.id));\r\n                                        setMovingFiles(selectedFiles);\r\n                                    } else {\r\n                                        setMovingFiles([contextMenu.file]);\r\n                                    }\r\n                                }\r\n                            },\r\n                            {\r\n                                label: 'Delete',\r\n                                icon: <Trash2 size={16} />,\r\n                                danger: true,\r\n                                onClick: () => {\r\n                                    if (selectedFileIds.size > 1 && selectedFileIds.has(contextMenu.file.id)) {\r\n                                        handleDeleteRequest(Array.from(selectedFileIds));\r\n                                    } else {\r\n                                        handleDeleteRequest(contextMenu.file.id);\r\n                                    }\r\n                                }\r\n                            }\r\n                        ]}\r\n                    />\r\n                )\r\n            }\r\n        </div >\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4346, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport prisma from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nexport async function updateTaskStatus(id: string, status: string) {\r\n    try {\r\n        await prisma.task.update({\r\n            where: { id },\r\n            data: { status },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to update task status:', error);\r\n        return { success: false, error: 'Failed to update task status' };\r\n    }\r\n}\r\n\r\nexport async function deleteTask(id: string) {\r\n    try {\r\n        await prisma.task.delete({\r\n            where: { id },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete task:', error);\r\n        return { success: false, error: 'Failed to delete task' };\r\n    }\r\n}\r\n\r\nexport async function createTask(data: { title: string; description?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        console.log('CreatesTask - Found User:', user);\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        await prisma.task.create({\r\n            data: {\r\n                title: data.title,\r\n                description: data.description,\r\n                status: 'pending',\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: { name: 'Manual Task', email: '' },\r\n                    preview: data.description || 'No description',\r\n                    tags: ['Manual']\r\n                })\r\n            },\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to create task:', error);\r\n        return { success: false, error: 'Failed to create task' };\r\n    }\r\n}\r\n\r\n// Helper to recount items in a folder\r\nasync function updateFolderItemCount(folderId: string) {\r\n    if (!folderId) return;\r\n    try {\r\n        const count = await prisma.workspaceFile.count({\r\n            where: { parentId: folderId }\r\n        });\r\n        await prisma.workspaceFile.update({\r\n            where: { id: folderId },\r\n            data: { items: `${count} items` }\r\n        });\r\n    } catch (e) {\r\n        console.error('Failed to update folder count:', e);\r\n    }\r\n}\r\n\r\n// Helper to get next order value\r\nasync function getNextOrderValue(parentId: string | null) {\r\n    const lastFile = await prisma.workspaceFile.findFirst({\r\n        where: { parentId },\r\n        orderBy: { order: 'desc' }\r\n    });\r\n    return (lastFile?.order || 0) + 1000;\r\n}\r\n\r\nexport async function createFile(data: { name: string, type: string, size?: string, items?: string, parentId?: string }) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n        if (!user) throw new Error('User not found');\r\n\r\n        const nextOrder = await getNextOrderValue(data.parentId || null);\r\n\r\n        const newFile = await prisma.workspaceFile.create({\r\n            data: {\r\n                name: data.name,\r\n                type: data.type,\r\n                size: data.size,\r\n                items: data.items,\r\n                parentId: data.parentId,\r\n                userId: user.id,\r\n                shared: false,\r\n                order: nextOrder\r\n            }\r\n        });\r\n\r\n        if (data.parentId) {\r\n            await updateFolderItemCount(data.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true, file: newFile };\r\n    } catch (error) {\r\n        console.error('Failed to create file:', error);\r\n        return { success: false, error: 'Failed to create file' };\r\n    }\r\n}\r\n\r\nexport async function reorderFiles(items: { id: string, order: number }[]) {\r\n    try {\r\n        // Run in transaction for safety\r\n        await prisma.$transaction(\r\n            items.map((item) =>\r\n                prisma.workspaceFile.update({\r\n                    where: { id: item.id },\r\n                    data: { order: item.order }\r\n                })\r\n            )\r\n        );\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to reorder files:', error);\r\n        return { success: false, error: 'Failed to reorder files' };\r\n    }\r\n}\r\n\r\nexport async function deleteFile(id: string) {\r\n    try {\r\n        // Get file first to check parent\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n\r\n        await prisma.workspaceFile.delete({\r\n            where: { id }\r\n        });\r\n\r\n        if (file?.parentId) {\r\n            await updateFolderItemCount(file.parentId);\r\n        }\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to delete file:', error);\r\n        return { success: false, error: 'Failed to delete file' };\r\n    }\r\n}\r\n\r\nexport async function uploadFile(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const parentId = formData.get('parentId') as string | null;\r\n        if (!file) throw new Error('No file uploaded');\r\n\r\n        const bytes = await file.arrayBuffer();\r\n        const buffer = Buffer.from(bytes);\r\n\r\n        const fileName = file.name;\r\n        const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n        // mkdir -p public/uploads is already done but let's be safe\r\n        const filePath = join(uploadDir, fileName);\r\n        await writeFile(filePath, buffer);\r\n\r\n        const sizeInMb = file.size / (1024 * 1024);\r\n        const sizeStr = sizeInMb < 0.1\r\n            ? `${(file.size / 1024).toFixed(1)} KB`\r\n            : `${sizeInMb.toFixed(1)} MB`;\r\n\r\n        const ext = fileName.split('.').pop()?.toLowerCase() || 'file';\r\n        let type = ext;\r\n        if (['jpg', 'jpeg', 'png', 'webp', 'gif'].includes(ext)) type = 'image';\r\n        if (ext === 'pdf') type = 'pdf';\r\n\r\n        // Reuse createFile which handles the count update\r\n        return await createFile({\r\n            name: fileName,\r\n            type: type,\r\n            size: sizeStr,\r\n            parentId: parentId || undefined\r\n        });\r\n    } catch (error) {\r\n        console.error('Failed to upload file:', error);\r\n        return { success: false, error: 'Failed to upload file' };\r\n    }\r\n}\r\n\r\nexport async function moveFile(id: string, parentId: string | null) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        const oldParentId = file?.parentId;\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { parentId }\r\n        });\r\n\r\n        if (oldParentId) await updateFolderItemCount(oldParentId);\r\n        if (parentId) await updateFolderItemCount(parentId);\r\n\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to move file:', error);\r\n        return { success: false, error: 'Failed to move file' };\r\n    }\r\n}\r\n\r\nexport async function renameFile(id: string, name: string) {\r\n    try {\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { name }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to rename file:', error);\r\n        return { success: false, error: 'Failed to rename file' };\r\n    }\r\n}\r\n\r\nexport async function toggleFileShare(id: string) {\r\n    try {\r\n        const file = await prisma.workspaceFile.findUnique({ where: { id } });\r\n        if (!file) throw new Error('File not found');\r\n\r\n        await prisma.workspaceFile.update({\r\n            where: { id },\r\n            data: { shared: !file.shared }\r\n        });\r\n        revalidatePath('/');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Failed to toggle share:', error);\r\n        return { success: false, error: 'Failed to toggle share' };\r\n    }\r\n}\r\nimport { parseEmailToTask, EmailPayload } from '@/lib/email-processor';\r\n\r\nexport async function simulateIncomingEmail(payload: EmailPayload) {\r\n    try {\r\n        const user = await prisma.user.findUnique({\r\n            where: { email: 'demo@example.com' }\r\n        });\r\n\r\n        if (!user) throw new Error('User not found');\r\n\r\n        // Parse the email \"intelligently\"\r\n        const parsedData = parseEmailToTask(payload);\r\n\r\n        // Create the task\r\n        const newTask = await prisma.task.create({\r\n            data: {\r\n                title: parsedData.title,\r\n                description: parsedData.description,\r\n                status: 'unread', // New emails start as unread\r\n                userId: user.id,\r\n                emailSource: JSON.stringify({\r\n                    sender: {\r\n                        name: payload.from.split('@')[0], // Simple name extraction\r\n                        email: payload.from\r\n                    },\r\n                    preview: parsedData.description.substring(0, 100) + (parsedData.description.length > 100 ? '...' : ''),\r\n                    tags: parsedData.tags,\r\n                    priority: parsedData.priority\r\n                }),\r\n                // We could map priority/tags to Prisma model later if we extend the schema\r\n            }\r\n        });\r\n\r\n        revalidatePath('/');\r\n        return { success: true, task: newTask };\r\n    } catch (error) {\r\n        console.error('Failed to process email:', error);\r\n        return { success: false, error: 'Failed to process email' };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAkCsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,8CAAA"}},
    {"offset": {"line": 4360, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/components/CreateTaskModal.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, Plus, Loader2 } from 'lucide-react';\r\nimport { createTask } from '@/app/actions';\r\nimport { useRouter } from 'next/navigation';\r\nimport { toast } from 'sonner';\r\nimport { useKeyboardShortcuts } from '@/hooks/useKeyboardShortcuts';\r\n\r\nexport default function CreateTaskModal() {\r\n    const router = useRouter();\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [title, setTitle] = useState('');\r\n    const [description, setDescription] = useState('');\r\n\r\n    useKeyboardShortcuts({\r\n        onNew: () => setIsOpen(true),\r\n        onEscape: () => setIsOpen(false),\r\n        enabled: true\r\n    });\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!title.trim()) {\r\n            toast.error('Task title is required');\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        const loadingToast = toast.loading('Creating task...');\r\n\r\n        try {\r\n            const result = await createTask({ title, description });\r\n\r\n            if (result.success) {\r\n                toast.success('Task created successfully', { id: loadingToast });\r\n                setIsOpen(false);\r\n                setTitle('');\r\n                setDescription('');\r\n                router.refresh();\r\n            } else {\r\n                toast.error(result.error || 'Failed to create task', { id: loadingToast });\r\n            }\r\n        } catch (error) {\r\n            toast.error('An error occurred', { id: loadingToast });\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <button\r\n                onClick={() => setIsOpen(true)}\r\n                className=\"fixed bottom-8 right-8 p-4 bg-blue-600 hover:bg-blue-500 text-white rounded-full shadow-lg hover:shadow-blue-500/20 transition-all active:scale-95 group z-30\"\r\n            >\r\n                <Plus size={24} className=\"group-hover:rotate-90 transition-transform\" />\r\n            </button>\r\n\r\n            <AnimatePresence>\r\n                {isOpen && (\r\n                    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            onClick={() => setIsOpen(false)}\r\n                            className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\r\n                        />\r\n                        <motion.div\r\n                            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n                            className=\"w-full max-w-lg bg-zinc-900 border border-white/10 rounded-2xl p-6 shadow-2xl relative z-10\"\r\n                        >\r\n                            <div className=\"flex items-center justify-between mb-6\">\r\n                                <h2 className=\"text-xl font-bold text-white\">New Task</h2>\r\n                                <button\r\n                                    onClick={() => setIsOpen(false)}\r\n                                    className=\"p-2 hover:bg-white/10 rounded-full transition-colors text-white/50 hover:text-white\"\r\n                                >\r\n                                    <X size={20} />\r\n                                </button>\r\n                            </div>\r\n\r\n                            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-white/60 mb-1\">Title</label>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={title}\r\n                                        onChange={(e) => setTitle(e.target.value)}\r\n                                        placeholder=\"What needs to be done?\"\r\n                                        className=\"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder:text-white/20 focus:outline-none focus:ring-2 focus:ring-blue-500/50\"\r\n                                        autoFocus\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-medium text-white/60 mb-1\">Description</label>\r\n                                    <textarea\r\n                                        value={description}\r\n                                        onChange={(e) => setDescription(e.target.value)}\r\n                                        placeholder=\"Add details...\"\r\n                                        rows={4}\r\n                                        className=\"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white placeholder:text-white/20 focus:outline-none focus:ring-2 focus:ring-blue-500/50 resize-none\"\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"flex justify-end gap-3 mt-6\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => setIsOpen(false)}\r\n                                        className=\"px-4 py-2 text-sm font-medium text-white/60 hover:text-white transition-colors\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        disabled={isLoading || !title.trim()}\r\n                                        className=\"px-6 py-2 bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm font-medium rounded-lg transition-all flex items-center gap-2\"\r\n                                    >\r\n                                        {isLoading && <Loader2 size={16} className=\"animate-spin\" />}\r\n                                        Create Task\r\n                                    </button>\r\n                                </div>\r\n                            </form>\r\n                        </motion.div>\r\n                    </div>\r\n                )}\r\n            </AnimatePresence>\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AARA;;;;;;;;;AAUe,SAAS;IACpB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAE/C,IAAA,4JAAoB,EAAC;QACjB,OAAO,IAAM,UAAU;QACvB,UAAU,IAAM,UAAU;QAC1B,SAAS;IACb;IAEA,MAAM,eAAe,OAAO;QACxB,EAAE,cAAc;QAChB,IAAI,CAAC,MAAM,IAAI,IAAI;YACf,iJAAK,CAAC,KAAK,CAAC;YACZ;QACJ;QAEA,aAAa;QACb,MAAM,eAAe,iJAAK,CAAC,OAAO,CAAC;QAEnC,IAAI;YACA,MAAM,SAAS,MAAM,IAAA,gKAAU,EAAC;gBAAE;gBAAO;YAAY;YAErD,IAAI,OAAO,OAAO,EAAE;gBAChB,iJAAK,CAAC,OAAO,CAAC,6BAA6B;oBAAE,IAAI;gBAAa;gBAC9D,UAAU;gBACV,SAAS;gBACT,eAAe;gBACf,OAAO,OAAO;YAClB,OAAO;gBACH,iJAAK,CAAC,KAAK,CAAC,OAAO,KAAK,IAAI,yBAAyB;oBAAE,IAAI;gBAAa;YAC5E;QACJ,EAAE,OAAO,OAAO;YACZ,iJAAK,CAAC,KAAK,CAAC,qBAAqB;gBAAE,IAAI;YAAa;QACxD,SAAU;YACN,aAAa;QACjB;IACJ;IAEA,qBACI;;0BACI,8OAAC;gBACG,SAAS,IAAM,UAAU;gBACzB,WAAU;0BAEV,cAAA,8OAAC,0MAAI;oBAAC,MAAM;oBAAI,WAAU;;;;;;;;;;;0BAG9B,8OAAC,4MAAe;0BACX,wBACG,8OAAC;oBAAI,WAAU;;sCACX,8OAAC,oMAAM,CAAC,GAAG;4BACP,SAAS;gCAAE,SAAS;4BAAE;4BACtB,SAAS;gCAAE,SAAS;4BAAE;4BACtB,MAAM;gCAAE,SAAS;4BAAE;4BACnB,SAAS,IAAM,UAAU;4BACzB,WAAU;;;;;;sCAEd,8OAAC,oMAAM,CAAC,GAAG;4BACP,SAAS;gCAAE,SAAS;gCAAG,OAAO;gCAAM,GAAG;4BAAG;4BAC1C,SAAS;gCAAE,SAAS;gCAAG,OAAO;gCAAG,GAAG;4BAAE;4BACtC,MAAM;gCAAE,SAAS;gCAAG,OAAO;gCAAM,GAAG;4BAAG;4BACvC,WAAU;;8CAEV,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAG,WAAU;sDAA+B;;;;;;sDAC7C,8OAAC;4CACG,SAAS,IAAM,UAAU;4CACzB,WAAU;sDAEV,cAAA,8OAAC,iMAAC;gDAAC,MAAM;;;;;;;;;;;;;;;;;8CAIjB,8OAAC;oCAAK,UAAU;oCAAc,WAAU;;sDACpC,8OAAC;;8DACG,8OAAC;oDAAM,WAAU;8DAA+C;;;;;;8DAChE,8OAAC;oDACG,MAAK;oDACL,OAAO;oDACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;oDACxC,aAAY;oDACZ,WAAU;oDACV,SAAS;;;;;;;;;;;;sDAGjB,8OAAC;;8DACG,8OAAC;oDAAM,WAAU;8DAA+C;;;;;;8DAChE,8OAAC;oDACG,OAAO;oDACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;oDAC9C,aAAY;oDACZ,MAAM;oDACN,WAAU;;;;;;;;;;;;sDAIlB,8OAAC;4CAAI,WAAU;;8DACX,8OAAC;oDACG,MAAK;oDACL,SAAS,IAAM,UAAU;oDACzB,WAAU;8DACb;;;;;;8DAGD,8OAAC;oDACG,MAAK;oDACL,UAAU,aAAa,CAAC,MAAM,IAAI;oDAClC,WAAU;;wDAET,2BAAa,8OAAC,4NAAO;4DAAC,MAAM;4DAAI,WAAU;;;;;;wDAAkB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWrG"}},
    {"offset": {"line": 4646, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Drod/Source/a/src/components/Dashboard.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport Layout from '@/components/Layout';\r\nimport InboxTable from '@/components/InboxTable';\r\nimport FileManager from '@/components/FileManager';\r\nimport { Mail, Folder } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport { Task, WorkspaceFile } from '@prisma/client';\r\n\r\nimport CreateTaskModal from './CreateTaskModal';\r\n\r\ninterface DashboardProps {\r\n    tasks: Task[];\r\n    files: WorkspaceFile[];\r\n}\r\n\r\nexport default function Dashboard({ tasks, files }: DashboardProps) {\r\n    const [activeTab, setActiveTab] = useState<'inbox' | 'files'>('inbox');\r\n\r\n    return (\r\n        <Layout>\r\n            <CreateTaskModal />\r\n            {/* Tab Switcher */}\r\n            <div className=\"flex items-center gap-2 mb-8 p-1 bg-white/5 w-fit rounded-lg border border-white/5\">\r\n                <button\r\n                    onClick={() => setActiveTab('inbox')}\r\n                    className={cn(\r\n                        \"flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all\",\r\n                        activeTab === 'inbox' ? \"bg-white/10 text-white shadow-sm\" : \"text-white/50 hover:text-white/80\"\r\n                    )}\r\n                >\r\n                    <Mail size={16} /> Inbox\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('files')}\r\n                    className={cn(\r\n                        \"flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all\",\r\n                        activeTab === 'files' ? \"bg-white/10 text-white shadow-sm\" : \"text-white/50 hover:text-white/80\"\r\n                    )}\r\n                >\r\n                    <Folder size={16} /> Files\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"mt-4\">\r\n                {activeTab === 'inbox' ? <InboxTable tasks={tasks} /> : <FileManager files={files} />}\r\n            </div>\r\n        </Layout>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AAVA;;;;;;;;;AAiBe,SAAS,UAAU,EAAE,KAAK,EAAE,KAAK,EAAkB;IAC9D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAoB;IAE9D,qBACI,8OAAC,uIAAM;;0BACH,8OAAC,gJAAe;;;;;0BAEhB,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBACG,SAAS,IAAM,aAAa;wBAC5B,WAAW,IAAA,yHAAE,EACT,mFACA,cAAc,UAAU,qCAAqC;;0CAGjE,8OAAC,0MAAI;gCAAC,MAAM;;;;;;4BAAM;;;;;;;kCAEtB,8OAAC;wBACG,SAAS,IAAM,aAAa;wBAC5B,WAAW,IAAA,yHAAE,EACT,mFACA,cAAc,UAAU,qCAAqC;;0CAGjE,8OAAC,gNAAM;gCAAC,MAAM;;;;;;4BAAM;;;;;;;;;;;;;0BAI5B,8OAAC;gBAAI,WAAU;0BACV,cAAc,wBAAU,8OAAC,2IAAU;oBAAC,OAAO;;;;;yCAAY,8OAAC,4IAAW;oBAAC,OAAO;;;;;;;;;;;;;;;;;AAI5F"}}]
}